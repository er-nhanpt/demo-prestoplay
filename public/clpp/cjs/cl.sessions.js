(function(){var g={}; var _ = _ || {}
var f=function(window){var uA="apiUrl config is missing",vA="prestoplay-web",wA=function(a,b){a.j=a.j.filter(function(c){return c!==b})},xA=function(a){var b=0>a;a=Math.abs(a);var c=a>>>0;a=Math.floor((a-c)/4294967296);a>>>=0;b&&(a=~a>>>0,c=(~c>>>0)+1,4294967295<c&&(c=0,a++,4294967295<a&&(a=0)));return[c,a]},yA=function(){this.a=[]},BA=function(a,b,c){zA(a,b,c,function(d,e){AA(d,e)})},AA=function(a,b){if(0<=b)CA(a,b);else{for(var c=b,d=0;9>d;d++)a.a.push(c&127|128),c>>=7;a.a.push(1)}},EA=function(a,b,c){zA(a,b,c,function(d,
e){if(0<=e){var f=_.w(xA(e)),g=f.next().value;f=f.next().value;DA(d,g,f)}else f=_.w(xA(e)),g=f.next().value,f=f.next().value,DA(d,g,f)})},GA=function(a,b,c){FA(a,b,c,function(d,e){for(var f=0;f<e.length;f++){var g=e.charCodeAt(f);if(128>g)d.a.push(g);else if(2048>g)d.a.push(g>>6|192),d.a.push(g&63|128);else if(65536>g)if(55296<=g&&56319>=g&&f+1<e.length){var h=e.charCodeAt(f+1);56320<=h&&57343>=h&&(g=1024*(g-55296)+h-56320+65536,d.a.push(g>>18|240),d.a.push(g>>12&63|128),d.a.push(g>>6&63|128),d.a.push(g&
63|128),f++)}else d.a.push(g>>12|224),d.a.push(g>>6&63|128),d.a.push(g&63|128)}})},IA=function(a,b,c){FA(a,b,c,function(d,e){HA(d,e.a())})},JA=function(a,b,c){FA(a,b,c,function(d,e){HA(d,e)})},HA=function(a,b){a.a.push.apply(a.a,b)},zA=function(a,b,c,d){if(!(null===c||void 0===c||typeof c===_.k&&0===c||typeof c===_.ig&&0===c.length||Array.isArray(c)&&0===c.length))if(Array.isArray(c)){CA(a,b<<3|2);b=new yA;for(var e=0;e<c.length;e++)d(b,c[e]);AA(a,b.length());HA(a,b.end())}else CA(a,b<<3|0),d(a,c)},
FA=function(a,b,c,d){if(!(null===c||void 0===c||typeof c===_.k&&0===c||typeof c===_.ig&&0===c.length||Array.isArray(c)&&0===c.length))if(Array.isArray(c))for(var e=0;e<c.length;e++){CA(a,b<<3|2);var f=new yA;d(f,c[e]);AA(a,f.length());HA(a,f.end())}else CA(a,b<<3|2),b=new yA,d(b,c),AA(a,b.length()),HA(a,b.end())},CA=function(a,b){for(;127<b;)a.a.push(b&127|128),b>>>=7;a.a.push(b)},DA=function(a,b,c){for(;0<c||127<b;)a.a.push(b&127|128),b=(b>>>7|c<<25)>>>0,c>>>=7;a.a.push(b)},KA=function(a,b,c,d){this.downloadId=
a;this.h=b;this.duration=c;this.j=d;this.f=[]},LA=function(a,b){this.f=a;this.url=b;this.downloadId=null;this.headers=[];this.size=this.duration=null},MA=function(a,b){this.h=a;this.f=b},NA=function(a){this.cause=a;this.f=this.message=this.severity=this.errorCode=null},OA=function(a,b){this.key=a;this.value=b},PA=function(){this.cause=this.severity=this.code=null},QA=function(){this.data=null},RA=function(){this.data=null;var a=new Uint8Array(16);crypto.getRandomValues(a);a[6]=a[6]&15|64;a[8]=a[8]&
63|128;this.data=a},SA=function(){this.headers=[]},TA=function(){},UA=function(a){this.j=a;this.f=this.h=this.time=this.sessionId=null},VA=function(){this.f=null;this.events=[]},WA=function(){this.f=this.h=null},XA=function(){this.f=this.h=null},YA=function(a){var b=new XA;b.h=Math.floor(a/1E3);b.f=a%1E3*1E6;return b},aB=function(a,b,c,d,e){var f=new Uint8Array([]),g=this;var h=void 0===h?2500:h;this.o=f;this.l=e;this.w=new RA;this.A=new RA;this.a=[];this.h=setInterval(function(){return ZA(g)},h);
this.f=null;this.j=!1;$A(this,a,b,c,d)},bB=function(a){return _.I(function(b){switch(b.a){case 1:a.h&&(clearInterval(a.h),a.h=null);if(!a.f){b.F(2);break}return _.y(b,a.f,2);case 2:if(!(0<a.a.length)){b.F(4);break}return _.y(b,ZA(a),5);case 5:a.a=[];case 4:a.j=!0,_.B(b)}})},$A=function(a,b,c,d,e){var f=new SA;f.headers=[new OA("CL-BROWSER-NAME",b),new OA("CL-BROWSER-VERSION",c),new OA("CL-OS-FAMILY",d),new OA("CL-OS-VERSION",e),new OA("CL-SDK-NAME",vA),new OA("CL-SDK-NAME",vA),new OA("CL-SDK-VERSION",
_.ha)];cB(a,f)},ZA=function(a){var b,c,d,e;return _.I(function(f){if(1==f.a){if(a.j||a.f)return f["return"]();0===a.a.length&&cB(a,new TA);b=function(){};a.f=new Promise(function(g){b=g});_.rh(f);c=new VA;c.f=a.o;c.events.push.apply(c.events,_.eh(a.a));d=_.eh(a.a).concat();return _.y(f,fetch(a.l,{method:_.Fb,headers:{"Content-Type":"application/proto"},body:new Uint8Array(c.a())}),4)}if(2!=f.a)if(e=f.f,e.ok)a.a=a.a.filter(function(g){return!d.includes(g)});else throw Error("An error occurred while sending telemetry events to the API, status\x3d'"+
(e.status+"' statusText\x3d'"+e.statusText+"'"));_.th(f);b();a.f=null;return _.uh(f)})},cB=function(a,b){if(!a.j){var c=new UA(a.w);c.sessionId=a.A;var d=Date.now(),e=new WA;e.h=Math.floor(d/1E3);e.f=d%1E3*1E6;c.time=e;c.h=b.getId();c.f=new Uint8Array(b.a());a.a.push(c)}},dB=function(){this.reason=this.currentState=this.previousState=null},eB=function(){this.m=null;this.a=this.l=!1;this.f=new _.Wh;this.h=null;this.g=new _.K("clpp.sessions.SessionsPlugin");this.o=this.Km.bind(this);this.j=this.Jm.bind(this)},
mB=function(a){switch(a){case _.Vp:return fB;case _.gq:return gB;case _.$p:return hB;case _.iq:return iB;case _.hq:return jB;case _.bq:return kB;case _.fq:return lB;default:return null}},uB=function(a,b){switch(a){case 1:return nB;case 2:return b===_.r?oB:b===_.Zc?pB:b===_.Q?qB:b===_.ye?rB:sB;case 3:return tB;default:return sB}},vB=function(a){var b;_.I(function(c){if(1==c.a)return a.g.info("Destroy the session and stop sending events."),_.Zh(a.f),a.a=!1,b=a.m.getNetworkEngine(),b.vg(a.o),b.me(a.j),
wA(b,a.j),a.h?_.y(c,bB(a.h),3):c.F(0);a.h=null;_.B(c)})},wB=function(a,b){a.g.debug("Sending event",b);cB(a.h,b)},xB=function(){};yA.prototype.length=function(){return this.a.length};yA.prototype.end=function(){var a=this.a;this.a=[];return a};KA.prototype.a=function(){var a=new yA;IA(a,1,this.downloadId);BA(a,2,this.h);IA(a,3,this.duration);BA(a,4,this.j);IA(a,5,this.f);return a.end()};KA.prototype.getId=function(){return 4};LA.prototype.a=function(){var a=new yA;BA(a,1,this.f);IA(a,2,this.downloadId);GA(a,3,this.url);IA(a,4,this.headers);GA(a,5,null);IA(a,6,null);IA(a,7,this.duration);EA(a,8,this.size);return a.end()};LA.prototype.getId=function(){return 2};MA.prototype.a=function(){var a=new yA;BA(a,1,this.h);JA(a,2,this.f);return a.end()};NA.prototype.a=function(){var a=new yA;BA(a,1,this.errorCode);BA(a,2,this.severity);GA(a,3,this.message);GA(a,4,this.f);IA(a,5,this.cause);return a.end()};NA.prototype.getId=function(){return 7};OA.prototype.a=function(){var a=new yA;GA(a,1,this.key);GA(a,2,this.value);return a.end()};PA.prototype.a=function(){var a=new yA;BA(a,1,this.code);BA(a,2,this.severity);IA(a,3,this.cause);return a.end()};PA.prototype.getId=function(){return 12};QA.prototype.a=function(){var a=new yA;JA(a,1,this.data);return a.end()};_.x(RA,QA);RA.prototype.toString=function(){for(var a=[],b=0;256>b;++b)a.push((b+256).toString(16).slice(1));return a[this.data[0]]+a[this.data[1]]+a[this.data[2]]+a[this.data[3]]+"-"+a[this.data[4]]+a[this.data[5]]+"-"+a[this.data[6]]+a[this.data[7]]+"-"+a[this.data[8]]+a[this.data[9]]+"-"+a[this.data[10]]+a[this.data[11]]+a[this.data[12]]+a[this.data[13]]+a[this.data[14]]+a[this.data[15]]};SA.prototype.a=function(){var a=new yA;IA(a,1,this.headers);return a.end()};SA.prototype.getId=function(){return 1};TA.prototype.a=function(){return(new yA).end()};TA.prototype.getId=function(){return 6};UA.prototype.a=function(){var a=new yA;IA(a,1,this.j);IA(a,2,this.sessionId);IA(a,3,this.time);EA(a,4,null);GA(a,5,null);BA(a,6,this.h);JA(a,7,this.f);return a.end()};VA.prototype.a=function(){var a=new yA;JA(a,1,this.f);IA(a,2,this.events);return a.end()};WA.prototype.a=function(){var a=new yA;EA(a,1,this.h);BA(a,2,this.f);return a.end()};XA.prototype.a=function(){var a=new yA;EA(a,1,this.h);BA(a,2,this.f);return a.end()};dB.prototype.a=function(){var a=new yA;BA(a,1,this.previousState);BA(a,2,this.currentState);BA(a,3,this.reason);IA(a,4,null);IA(a,5,null);IA(a,6,null);return a.end()};dB.prototype.getId=function(){return 5};_.x(eB,_.Gv);_.u=eB.prototype;_.u.onPlayerCreated=function(a){this.m=a};
_.u.onContentWillLoad=function(a){var b=a.getConfiguration().sessions;(b=!(!b||typeof b!==_.Xe))||this.g.debug("Sessions plugin is loaded but not configured. Will do nothing.");if(this.l=b)b=a.getConfiguration().sessions,b.apiUrl?(this.g.debug(_.ua),this.g.info("Create a session and start sending events."),a=_.xk(),this.h=new aB(a.browser,a.browserVersion.name,a.os,a.osVersion.name,b.apiUrl),this.f.on(this.m,_.fg,this.Jk.bind(this)),this.f.on(this.m,_.Yf,this.Ik.bind(this)),this.f.on(this.m,_.Xf,
this.Hk.bind(this)),this.f.on(this.m,_.qe,this.Gk.bind(this)),a=this.m.getNetworkEngine(),a.zf(this.o),a.Rc(this.j),a.j.push(this.j)):(this.g.warn(uA),a.onError(new _.O(1,9,15E3,uA)))};_.u.onPlayerWillRelease=function(){vB(this)};_.u.id=function(){return"sessions"};_.u.Jk=function(a){if(!this.a){a=a.detail;var b=a.currentState,c=new dB;c.previousState=mB(a.previousState);c.currentState=mB(b);wB(this,c)}};
_.u.Ik=function(){if(!this.a){var a=new dB;a.previousState=mB(this.m.getState());a.currentState=yB;wB(this,a);this.a=!0}};_.u.Hk=function(){if(this.a){var a=new dB;a.previousState=yB;a.currentState=mB(this.m.getState());wB(this,a);this.a=!1}};_.u.Gk=function(a){a=a.detail;var b=new PA;b=new NA(new MA(b.getId(),new Uint8Array(b.a())));b.errorCode=a.code;b.message=a.message;b.f=a.stack;b.severity=a.severity===_.P?zB:AB;wB(this,b)};
_.u.Km=function(a){var b=new RA;a.downloadId=b;var c=new LA(uB(a.type,a.contentType),a.uris[0]);c.downloadId=b;c.headers=Object.keys(a.headers).map(function(d){return new OA(d,a.headers[d])});wB(this,c)};_.u.Jm=function(a){var b=a.request.downloadId;b?(b=new KA(b,a.data.byteLength,YA(a.timeMs||0),a.status||-1),b.f=Object.keys(a.headers).map(function(c){return new OA(c,a.headers[c])}),wB(this,b)):this.g.warn("Download ID is missing on download completed event.")};xB.prototype.create=function(){return new eB};
_.gt(new xB);var AB=1,zB=2;var fB=0,gB=2,lB=3,yB=5,hB=6,iB=8,jB=10,kB=11;var nB=0,oB=1,pB=2,qB=3,rB=4,tB=5,sB=9;};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();