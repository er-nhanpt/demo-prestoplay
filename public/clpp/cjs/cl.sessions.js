(function(){var g={}; var _ = _ || {}
var f=function(window){var cA="apiUrl config is missing",dA="prestoplay-web",eA=function(a,b){a.j=a.j.filter(function(c){return c!==b})},fA=function(a){var b=0>a;a=Math.abs(a);var c=a>>>0;a=Math.floor((a-c)/4294967296);a>>>=0;b&&(a=~a>>>0,c=(~c>>>0)+1,4294967295<c&&(c=0,a++,4294967295<a&&(a=0)));return[c,a]},gA=function(){this.a=[]},jA=function(a,b,c){hA(a,b,c,function(d,e){iA(d,e)})},iA=function(a,b){if(0<=b)kA(a,b);else{for(var c=b,d=0;9>d;d++)a.a.push(c&127|128),c>>=7;a.a.push(1)}},mA=function(a,b,c){hA(a,b,c,function(d,
e){if(0<=e){var f=_.w(fA(e)),g=f.next().value;f=f.next().value;lA(d,g,f)}else f=_.w(fA(e)),g=f.next().value,f=f.next().value,lA(d,g,f)})},oA=function(a,b,c){nA(a,b,c,function(d,e){for(var f=0;f<e.length;f++){var g=e.charCodeAt(f);if(128>g)d.a.push(g);else if(2048>g)d.a.push(g>>6|192),d.a.push(g&63|128);else if(65536>g)if(55296<=g&&56319>=g&&f+1<e.length){var h=e.charCodeAt(f+1);56320<=h&&57343>=h&&(g=1024*(g-55296)+h-56320+65536,d.a.push(g>>18|240),d.a.push(g>>12&63|128),d.a.push(g>>6&63|128),d.a.push(g&
63|128),f++)}else d.a.push(g>>12|224),d.a.push(g>>6&63|128),d.a.push(g&63|128)}})},qA=function(a,b,c){nA(a,b,c,function(d,e){pA(d,e.a())})},rA=function(a,b,c){nA(a,b,c,function(d,e){pA(d,e)})},pA=function(a,b){a.a.push.apply(a.a,b)},hA=function(a,b,c,d){if(!(null===c||void 0===c||typeof c===_.k&&0===c||typeof c===_.fg&&0===c.length||Array.isArray(c)&&0===c.length))if(Array.isArray(c)){kA(a,b<<3|2);b=new gA;for(var e=0;e<c.length;e++)d(b,c[e]);iA(a,b.length());pA(a,b.end())}else kA(a,b<<3|0),d(a,c)},
nA=function(a,b,c,d){if(!(null===c||void 0===c||typeof c===_.k&&0===c||typeof c===_.fg&&0===c.length||Array.isArray(c)&&0===c.length))if(Array.isArray(c))for(var e=0;e<c.length;e++){kA(a,b<<3|2);var f=new gA;d(f,c[e]);iA(a,f.length());pA(a,f.end())}else kA(a,b<<3|2),b=new gA,d(b,c),iA(a,b.length()),pA(a,b.end())},kA=function(a,b){for(;127<b;)a.a.push(b&127|128),b>>>=7;a.a.push(b)},lA=function(a,b,c){for(;0<c||127<b;)a.a.push(b&127|128),b=(b>>>7|c<<25)>>>0,c>>>=7;a.a.push(b)},sA=function(a,b,c,d){this.downloadId=
a;this.h=b;this.duration=c;this.j=d;this.f=[]},tA=function(a,b){this.f=a;this.url=b;this.downloadId=null;this.headers=[];this.size=this.duration=null},uA=function(a,b){this.h=a;this.f=b},vA=function(a){this.cause=a;this.f=this.message=this.severity=this.errorCode=null},wA=function(a,b){this.key=a;this.value=b},xA=function(){this.cause=this.severity=this.code=null},yA=function(){this.data=null},zA=function(){this.data=null;var a=new Uint8Array(16);crypto.getRandomValues(a);a[6]=a[6]&15|64;a[8]=a[8]&
63|128;this.data=a},AA=function(){this.headers=[]},BA=function(){},CA=function(a){this.j=a;this.f=this.h=this.time=this.sessionId=null},DA=function(){this.f=null;this.events=[]},EA=function(){this.f=this.h=null},FA=function(){this.f=this.h=null},GA=function(a){var b=new FA;b.h=Math.floor(a/1E3);b.f=a%1E3*1E6;return b},JA=function(a,b,c,d,e){var f=new Uint8Array([]),g=this;var h=void 0===h?2500:h;this.o=f;this.l=e;this.w=new zA;this.A=new zA;this.a=[];this.h=setInterval(function(){return HA(g)},h);
this.f=null;this.j=!1;IA(this,a,b,c,d)},KA=function(a){return _.I(function(b){switch(b.a){case 1:a.h&&(clearInterval(a.h),a.h=null);if(!a.f){b.F(2);break}return _.y(b,a.f,2);case 2:if(!(0<a.a.length)){b.F(4);break}return _.y(b,HA(a),5);case 5:a.a=[];case 4:a.j=!0,_.A(b)}})},IA=function(a,b,c,d,e){var f=new AA;f.headers=[new wA("CL-BROWSER-NAME",b),new wA("CL-BROWSER-VERSION",c),new wA("CL-OS-FAMILY",d),new wA("CL-OS-VERSION",e),new wA("CL-SDK-NAME",dA),new wA("CL-SDK-NAME",dA),new wA("CL-SDK-VERSION",
_.ja)];LA(a,f)},HA=function(a){var b,c,d,e;return _.I(function(f){if(1==f.a){if(a.j||a.f)return f["return"]();0===a.a.length&&LA(a,new BA);b=function(){};a.f=new Promise(function(g){b=g});_.nh(f);c=new DA;c.f=a.o;c.events.push.apply(c.events,_.ah(a.a));d=_.ah(a.a).concat();return _.y(f,fetch(a.l,{method:_.Ib,headers:{"Content-Type":"application/proto"},body:new Uint8Array(c.a())}),4)}if(2!=f.a)if(e=f.f,e.ok)a.a=a.a.filter(function(g){return!d.includes(g)});else throw Error("An error occurred while sending telemetry events to the API, status\x3d'"+
(e.status+"' statusText\x3d'"+e.statusText+"'"));_.ph(f);b();a.f=null;return _.qh(f)})},LA=function(a,b){if(!a.j){var c=new CA(a.w);c.sessionId=a.A;var d=Date.now(),e=new EA;e.h=Math.floor(d/1E3);e.f=d%1E3*1E6;c.time=e;c.h=b.getId();c.f=new Uint8Array(b.a());a.a.push(c)}},MA=function(){this.reason=this.currentState=this.previousState=null},NA=function(){this.m=null;this.a=this.l=!1;this.f=new _.Sh;this.h=null;this.g=new _.K("clpp.sessions.SessionsPlugin");this.o=this.qm.bind(this);this.j=this.pm.bind(this)},
VA=function(a){switch(a){case _.Gp:return OA;case _.Sp:return PA;case _.Lp:return QA;case _.Up:return RA;case _.Tp:return SA;case _.Np:return TA;case _.Rp:return UA;default:return null}},cB=function(a,b){switch(a){case 1:return WA;case 2:return b===_.r?XA:b===_.$c?YA:b===_.Q?ZA:b===_.ve?$A:aB;case 3:return bB;default:return aB}},dB=function(a){var b;_.I(function(c){if(1==c.a)return a.g.info("Destroy the session and stop sending events."),_.Vh(a.f),a.a=!1,b=a.m.getNetworkEngine(),b.mg(a.o),b.ae(a.j),
eA(b,a.j),a.h?_.y(c,KA(a.h),3):c.F(0);a.h=null;_.A(c)})},eB=function(a,b){a.g.debug("Sending event",b);LA(a.h,b)},fB=function(){};gA.prototype.length=function(){return this.a.length};gA.prototype.end=function(){var a=this.a;this.a=[];return a};sA.prototype.a=function(){var a=new gA;qA(a,1,this.downloadId);jA(a,2,this.h);qA(a,3,this.duration);jA(a,4,this.j);qA(a,5,this.f);return a.end()};sA.prototype.getId=function(){return 4};tA.prototype.a=function(){var a=new gA;jA(a,1,this.f);qA(a,2,this.downloadId);oA(a,3,this.url);qA(a,4,this.headers);oA(a,5,null);qA(a,6,null);qA(a,7,this.duration);mA(a,8,this.size);return a.end()};tA.prototype.getId=function(){return 2};uA.prototype.a=function(){var a=new gA;jA(a,1,this.h);rA(a,2,this.f);return a.end()};vA.prototype.a=function(){var a=new gA;jA(a,1,this.errorCode);jA(a,2,this.severity);oA(a,3,this.message);oA(a,4,this.f);qA(a,5,this.cause);return a.end()};vA.prototype.getId=function(){return 7};wA.prototype.a=function(){var a=new gA;oA(a,1,this.key);oA(a,2,this.value);return a.end()};xA.prototype.a=function(){var a=new gA;jA(a,1,this.code);jA(a,2,this.severity);qA(a,3,this.cause);return a.end()};xA.prototype.getId=function(){return 12};yA.prototype.a=function(){var a=new gA;rA(a,1,this.data);return a.end()};_.x(zA,yA);zA.prototype.toString=function(){for(var a=[],b=0;256>b;++b)a.push((b+256).toString(16).slice(1));return a[this.data[0]]+a[this.data[1]]+a[this.data[2]]+a[this.data[3]]+"-"+a[this.data[4]]+a[this.data[5]]+"-"+a[this.data[6]]+a[this.data[7]]+"-"+a[this.data[8]]+a[this.data[9]]+"-"+a[this.data[10]]+a[this.data[11]]+a[this.data[12]]+a[this.data[13]]+a[this.data[14]]+a[this.data[15]]};AA.prototype.a=function(){var a=new gA;qA(a,1,this.headers);return a.end()};AA.prototype.getId=function(){return 1};BA.prototype.a=function(){return(new gA).end()};BA.prototype.getId=function(){return 6};CA.prototype.a=function(){var a=new gA;qA(a,1,this.j);qA(a,2,this.sessionId);qA(a,3,this.time);mA(a,4,null);oA(a,5,null);jA(a,6,this.h);rA(a,7,this.f);return a.end()};DA.prototype.a=function(){var a=new gA;rA(a,1,this.f);qA(a,2,this.events);return a.end()};EA.prototype.a=function(){var a=new gA;mA(a,1,this.h);jA(a,2,this.f);return a.end()};FA.prototype.a=function(){var a=new gA;mA(a,1,this.h);jA(a,2,this.f);return a.end()};MA.prototype.a=function(){var a=new gA;jA(a,1,this.previousState);jA(a,2,this.currentState);jA(a,3,this.reason);qA(a,4,null);qA(a,5,null);qA(a,6,null);return a.end()};MA.prototype.getId=function(){return 5};_.x(NA,_.pv);_.u=NA.prototype;_.u.onPlayerCreated=function(a){this.m=a};
_.u.onContentWillLoad=function(a){var b=a.getConfiguration().sessions;(b=!(!b||typeof b!==_.Ue))||this.g.debug("Sessions plugin is loaded but not configured. Will do nothing.");if(this.l=b)b=a.getConfiguration().sessions,b.apiUrl?(this.g.debug(_.wa),this.g.info("Create a session and start sending events."),a=_.qk(),this.h=new JA(a.browser,a.browserVersion.name,a.os,a.osVersion.name,b.apiUrl),this.f.on(this.m,_.cg,this.nk.bind(this)),this.f.on(this.m,_.Vf,this.mk.bind(this)),this.f.on(this.m,_.Uf,
this.lk.bind(this)),this.f.on(this.m,_.ne,this.S.bind(this)),a=this.m.getNetworkEngine(),a.nf(this.o),a.Oc(this.j),a.j.push(this.j)):(this.g.warn(cA),a.onError(new _.N(1,9,15E3,cA)))};_.u.onPlayerWillRelease=function(){dB(this)};_.u.id=function(){return"sessions"};_.u.nk=function(a){if(!this.a){a=a.detail;var b=a.currentState,c=new MA;c.previousState=VA(a.previousState);c.currentState=VA(b);eB(this,c)}};
_.u.mk=function(){if(!this.a){var a=new MA;a.previousState=VA(this.m.getState());a.currentState=gB;eB(this,a);this.a=!0}};_.u.lk=function(){if(this.a){var a=new MA;a.previousState=gB;a.currentState=VA(this.m.getState());eB(this,a);this.a=!1}};_.u.S=function(a){a=a.detail;var b=new xA;b=new vA(new uA(b.getId(),new Uint8Array(b.a())));b.errorCode=a.code;b.message=a.message;b.f=a.stack;b.severity=a.severity===_.P?hB:iB;eB(this,b)};
_.u.qm=function(a){var b=new zA;a.downloadId=b;var c=new tA(cB(a.type,a.contentType),a.uris[0]);c.downloadId=b;c.headers=Object.keys(a.headers).map(function(d){return new wA(d,a.headers[d])});eB(this,c)};_.u.pm=function(a){var b=a.request.downloadId;b?(b=new sA(b,a.data.byteLength,GA(a.timeMs||0),a.status||-1),b.f=Object.keys(a.headers).map(function(c){return new wA(c,a.headers[c])}),eB(this,b)):this.g.warn("Download ID is missing on download completed event.")};fB.prototype.create=function(){return new NA};
_.Qs(new fB);var iB=1,hB=2;var OA=0,PA=2,UA=3,gB=5,QA=6,RA=8,SA=10,TA=11;var WA=0,XA=1,YA=2,ZA=3,$A=4,bB=5,aB=9;};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();