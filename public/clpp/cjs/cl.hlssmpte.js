(function(){var g={}; var _ = _ || {}
var f=function(window){var hU=function(a){this.startTime=a.startTime;this.endTime=a.endTime;this.a=this.f=null;a=a.value;if(!_.M.R(a)){a:{var b=a.info;if(_.M.da(b)&&(b=b.toLowerCase().match(/lang:(\w+)/))&&b[1]){b=b[1].toLowerCase();break a}b=null}this.f=b;a=a.data;this.a=_.M.da(a)?a:null}},jU=function(a,b,c){this.m=a;this.l=b;this.j=c;this.a=new _.Sh;this.h=(a=_.dv(_.Xc))?new a(this.m.getConfiguration()):null;this.g=new _.K("clpp.hlssmpte.ImageCueHandler");this.f=null;iU(this)},iU=function(a){a.a.one(a.m,_.Fe,function(){return kU(a)})},
kU=function(a){var b=a.m.getSurface().getMedia();if(b)if(a.h){a.a.on(b.textTracks,_.Mc,function(d){return lU(a,d)});var c=Array.from(b.textTracks);c.filter(function(d){return d.kind===_.Ne}).forEach(function(d){lU(a,{track:d})});!mU(c)&&a.l&&(a.g.warn("The metadata track is not present. Changing an audio track in order to enforce the creation of the metadata track."),nU(a,b))}else a.g.warn("The clpp.ttml.TextParser class is not available. Please register the ttml component first.");else a.g.warn("A video element is not available. Skipping.")},
mU=function(a){return a.some(function(b){return b.kind===_.Ne})},nU=function(a,b){var c=a.m.getTrackManager(),d=c.na(),e=c.getAudioTracks().find(function(g){return g!==d});if(e){var f=function(){return c.Ea(d)};a.a.on(b.textTracks,_.Mc,function(g){g.track.kind===_.Ne&&(a.a.off(b.textTracks,_.Mc,f),f())});c.Ea(e)}else a.g.warn("Can't enforce the creation of the metadata track if single audio track. Skipping.")},lU=function(a,b){var c=b.track;c.kind===_.Ne&&(a.g.info("The metadata track has been added."),
c.mode=_.te,a.a.on(c,_.Sd,function(d){return oU(a,d)}))},oU=function(a,b){var c=pU(a);c&&Array.from(b.target.activeCues||[]).forEach(function(d){if(d!==a.f&&Number.isFinite(d.startTime)&&Number.isFinite(d.endTime)&&"org.id3"===d.type&&d.value&&"TXXX"===d.value.key){var e=new hU(d);if(e.f===c&&null!==e.a){a.f=d;d=a.h.parseMedia(_.R.$a(e.a),{periodStart:a.j,segmentStart:e.startTime,segmentEnd:e.endTime});var f=a.m.getTextDisplayer();f.remove(0,e.startTime);f.append(d.cues,d.styles)}}})},pU=function(a){return(a=
a.m.getTrackManager().xa())&&a.language&&a.language.toLowerCase()},qU=function(){this.a=null;this.f=!1},rU=function(){};jU.prototype.destroy=function(){this.a.release();this.f=null;return Promise.resolve()};_.x(qU,_.pv);qU.prototype.onPlayerCreated=function(){};qU.prototype.onContentWillLoad=function(a){if(this.f=_.wl()){var b=a.getConfiguration();b=_.M.bb(b.hlssmpte||{});_.M.Th(b.patchMetadataTrack)||(b.patchMetadataTrack=!1);_.M.sa(b.timestampOffset)||(b.timestampOffset=0);this.a=new jU(a,b.patchMetadataTrack,b.timestampOffset)}};qU.prototype.onPlayerWillDestroy=function(){var a=this;return _.I(function(b){if(1==b.a)return a.a?_.y(b,a.a.destroy(),3):b.F(0);a.a=null;_.A(b)})};qU.prototype.id=function(){return"hlssmpte"};
_.J("clpp.hlssmpte.HlsSmptePlugin",qU);qU.Id="hlssmpte";rU.prototype.create=function(){return new qU};_.Qs(new rU);};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();