(function(){var g={}; var _ = _ || {}
var f=function(window){var YS="CLPP Subtitle Styles",ZS="Unsupported unit",$S="clpp-text-plain",aT="clpp-text-ttml",bT="clpp.htmlcue.HtmlTextDisplayer",cT="initial",dT=function(a){return _.zi(a,{mh:function(b,c){return b.ma(c)}})},eT=function(a,b){if(0===b.length)return a;var c=a,d=a.findIndex(function(e){return e.startTime>=b[0].startTime});0<=d&&(c=c.slice(0,d));return c.concat(b)},fT=function(a,b){for(var c=0,d=a.length-1;c<=d;){var e=c+d>>1,f=b(a[e]);if(0===f)return e;0<f?c=e+1:d=e-1}return-1},gT=function(){},hT=function(a){if(!a.input)return null;
var b=a.input.match(/^([^<]*)(<[^>]+>?)?/);b=b[1]?b[1]:b[2];a.input=a.input.substr(b.length);return b},jT=function(a){for(var b=null;b=a.match(/&(amp|lt|gt|lrm|rlm|nbsp);/);)a=a.replace(b[0],function(c){return iT[c]});return a},lT=function(a,b){kT(a,b);Array.from(b.getElementsByTagName("*")).forEach(function(c){kT(a,c)})},kT=function(a,b){for(var c in a)null!=a[c]&&(b.style[c]=a[c])},mT=function(a,b){return 0===a?"0":a+b},nT=function(a,b){return 1>Math.abs(a-b)||a<b},oT=function(a,b){return a<b&&
1<Math.abs(a-b)},pT=function(a,b){return a>b&&1<Math.abs(a-b)},qT=function(a,b){return 1>Math.abs(a-b)||a>b},rT=function(a,b,c,d,e,f){this.left=a;this.f=b;this.top=c;this.a=d;this.height=e;this.width=f},sT=function(a){return new rT(a.left,a.f,a.top,a.a,a.height,a.width)},tT=function(a){var b=a.getBoundingClientRect(),c=getComputedStyle(a,null),d=parseFloat(c.getPropertyValue("border-left-width"))||0,e=parseFloat(c.getPropertyValue("border-right-width"))||0,f=parseFloat(c.getPropertyValue("border-top-width"))||
0;c=parseFloat(c.getPropertyValue("border-bottom-width"))||0;var g=(b.top||a.offsetTop)+f;f=(b.height||a.offsetHeight)-f-c;return new rT(b.left+d,b.right+e,g,(b.bottom||g+f)+c,f,(b.width||a.offsetWidth)-d-e)},uT=function(a,b){return b.some(function(c){return oT(a.left,c.f)&&pT(a.f,c.left)&&oT(a.top,c.a)&&pT(a.a,c.top)})},vT=function(a,b){return qT(a.top,b.top)&&nT(a.a,b.a)&&qT(a.left,b.left)&&nT(a.f,b.f)},wT=function(a,b,c){switch(c){case "+x":return oT(a.left,b.left);case "-x":return pT(a.f,b.f);
case "+y":return oT(a.top,b.top);case "-y":return pT(a.a,b.a);default:throw Error("Unknown axis");}},xT=function(a,b,c){this.id=a;this.w=b;this.B=c;this.a=this.o();this.j=!1},yT=function(a,b,c){xT.call(this,a.id,"clpp-text-cue",{});this.l=b;this.f=a;this.h=!!this.f.backgroundImage;this.C=c},AT=function(a){var b=a.a.childNodes[0],c=a.a.getBoundingClientRect(),d=b.getClientRects();b=c.height/d.length;c=c.width/d.length;return zT(a)?b:c},DT=function(a,b,c){return zT(a)&&_.M.sa(c)?mT(c,_.If):(BT(a)||
CT(a))&&_.M.sa(b)?mT(b,"%"):cT},BT=function(a){return a.f.writingMode===_.Ag},CT=function(a){return a.f.writingMode===_.Bg},zT=function(a){return a.f.writingMode===_.Di},ET=function(a,b,c){return(BT(a)||CT(a))&&_.M.sa(c)?mT(c,_.If):BT(a)&&_.M.R(c)?mT(0,_.If):zT(a)&&_.M.sa(b)?mT(b,"%"):cT},FT=function(a,b){if(typeof a.f.position===_.k&&typeof a.f.size===_.k)switch(b){case _.Be:return a.f.position;case "auto":case _.sd:return a.f.position-a.f.size/2;case _.Ce:return a.f.position-a.f.size}return 0},
GT=function(a){switch(a.f.positionAlign){case _.Be:return _.ye;case "auto":case _.sd:return _.Ci;case _.Ce:return _.Pf}return a.f.textAlign},HT=function(a){if(!a.f.positionAlign)switch(a.f.textAlign){case _.ye:case _.ye:return _.Be;case _.Ci:return _.sd;case _.Pf:case _.Pf:return _.Ce}return a.f.positionAlign},IT=function(a){switch(a.f.writingMode){case _.Di:return"horizontal-tb";case _.Ag:return _.Ag;case _.Bg:return _.Bg;default:throw Error("Unknown writing mode");}},JT=function(a,b){this.l=a;this.f=
a.a;this.j=void 0===b?!1:b;this.a=tT(a.a);this.h=[]},KT=function(a,b){if(a.j)switch(b.writingMode){case _.Di:return["-y"];case _.Ag:return["+x"];case _.Bg:return["-x"]}var c=[];switch(b.writingMode){case _.Di:c=["+y","-y"];break;case _.Ag:c=["+x","-x"];break;case _.Bg:c=["-x","+x"]}0>b.line&&(c=c.reverse());return c},LT=function(a){for(a.h=[];0<a.f.childNodes.length;)a.f.removeChild(a.f.childNodes[0]);a.a=tT(a.l.a)},MT=function(a,b,c){xT.call(this,a,b,c);this.h=null;this.l=[]},NT=function(a,b){LT(a.h);
a.l.unshift(b);for(var c=_.w(a.l),d=c.next();!d.done;d=c.next())a.h.append(d.value)},OT=function(a,b){MT.call(this,a.id,"clpp-text-cue-region",b);this.f=a},PT=function(a,b,c){a=a.f;var d=a.viewportAnchorUnits;if(d===_.Ii)return a.viewportAnchorY/100*c-a.regionAnchorY/100*b;if(0===d)return a.viewportAnchorY-a.regionAnchorY;throw Error(ZS);},RT=function(a){this.g=new _.K("clpp.htmlcue.StyleManager");this.j=[];this.h=a;this.l=[];this.a=QT(this,this.h);this.f=QT(this,this.h,!0);this.f.disabled=!0;this.g.debug("Stylesheet CLPP Subtitle Styles has been created.")},
ST=function(a,b){var c=!1;try{a.f.insertRule(b,0);var d=a.f.cssRules[0];d instanceof CSSStyleRule&&(c=d.selectorText.split(",").every(function(e){return 0===e.trim().indexOf("."+a.h+" ")}))}catch(e){}0<a.f.cssRules.length&&a.f.deleteRule(0);return c},TT=function(a,b){var c="."+a.h+" .clpp-text-container",d=c+" .clpp-text-cue";return b=b.replace(/::cue\((#[^)]+)\)/g,c+" $1").replace(/::cue\(([^)]+)\)/g,d+" $1").replace(/::cue-region\(([^)]+)\)/g,c+" $1 .clpp-text-cue").replace(/::cue/g,d).replace(/::cue-region/g,
c+" .clpp-text-cue-region .clpp-text-cue").replace(/::ttml/g,c)},QT=function(a,b,c){var d=document.createElement(_.hg),e=d.dataset;e.name=YS;e["for"]=b;c&&(e.name="CLPP Subtitle Styles (sandbox)",e.sandbox=!0);b=document.head;b.appendChild(d);UT(a,b);a.g.debug("Created HTML style element #CLPP Subtitle Styles.");return d.sheet},UT=function(a,b){var c=new MutationObserver(function(d){d.forEach(function(e){e.removedNodes.forEach(function(f){f.id===YS&&a.g.error("PRESTOplay HTML style element #CLPP Subtitle Styles has been unexpectedly removed! Some styles will not work!")})})});
c.observe(b,{subtree:!1,childList:!0});a.j.push(function(){return c.disconnect()})},XT=function(a){_.fv.call(this,a);var b=this;this.g=new _.K(bT);this.m=a;this.L=VT(a.getConfiguration());this.j=!1;this.f=[];this.C=a.getSurface().getContainer();this.h=new RT(a.getSurface().getUniqueCssClass());this.a=new MT(null,"clpp-text-container",{});this.w=new _.ju(a.getSurface(),this.Vj.bind(this));this.J=null;this.C?(this.C.appendChild(this.a.a),this.a.init(null)):this.g.warn("No container element! Subtitles will not appear. Please check your player surface configuration or switch to NativeTextDisplayer.");
this.G=new _.pl(function(){WT(b)});this.A=new Map;this.l=null},VT=function(a){a=_.M.bb(a.htmlcue||{});_.M.R(a.stretchSmpteImage)&&(a.stretchSmpteImage=!1);_.M.R(a.enableResizeObserver)&&(a.enableResizeObserver=!0);return a},YT=function(a,b){return a.startTime<=b&&a.endTime>b},WT=function(a,b){if((b||a.j)&&a.C){var c=a.m.getPosition();if(b||a.J!==c&&a.m.getState()===_.Up){a.J=c;var d=ZT(a,c);(c=b)||(c=a.l,c=!(null===c&&null===d||null!==c&&null!==d&&c.start===d.start&&c.end===d.end));if(c&&(a.l=d,$T(a),
d)){c={color:a.getFontColor()||void 0,backgroundColor:a.getBackgroundColor()||void 0,fontFamily:a.getFontFamily()||void 0,textShadow:_.kv(a)||void 0};d=a.f.slice(d.start,d.end+1);d=_.w(d);for(var e=d.next();!e.done;e=d.next()){var f=a;e=e.value;var g=f.a.a,h=null;switch(e.payloadType){case _.Kg:h="clpp-text-vtt";break;case _.pg:h=aT;break;case _.Bi:h=$S}h&&!g.classList.contains(h)&&_.uq(g,h);g=tT(f.a.a);if(0===g.width||0===g.height)f.g.warn("The height or width of the `.clpp-text-container` element is zero. Captions will not be displayed. Please check if the `clpp.styles.css` file has been included.");
else{kT({fontSize:aU(f,e.containerRows)},f.a.a);g=null;h=e.payloadType===_.Kg;var l=e.payloadType===_.pg;e.region&&(h||l||e.backgroundImage)&&(f.A.has(e.region.id)?g=f.A.get(e.region.id):(g=new OT(e.region,{}),f.A.set(e.region.id,g),NT(f.a,g)));e=new yT(e,f.L,c);g?NT(g,e):NT(f.a,e)}}}}}},ZT=function(a,b){var c=fT(a.f,function(e){return YT(e,b)?0:b!==e.startTime?b-e.startTime:b-e.endTime});if(-1===c)return null;for(var d=c;0<=d-1&&YT(a.f[d-1],b);)d--;for(;c+1<a.f.length&&YT(a.f[c+1],b);)c++;return{start:d,
end:c}},bU=function(a){$T(a);a.J=null;a.l=null;a.f=[]},$T=function(a){a.A.clear();if(a.a){var b=a.a.a;b.classList.remove("clpp-text-vtt");b.classList.remove(aT);b.classList.remove($S);a=a.a;LT(a.h);a.l=[]}},aU=function(a,b){var c=tT(a.a.a).height;if(null!==a.I)return a.getFontSize();if(null!==a.B){var d=a.getFontSizePercent();return Math.round(c*d)+_.If}if(typeof b===_.k&&0<b)return Math.round(c/b)+_.If;d=a.getFontSizePercent();return Math.round(c*d)+_.If},cU=function(){},dU=function(){};
gT.prototype.parse=function(a){a={input:a};for(var b=_.wq(_.Wd),c=[],d=b,e;null!==(e=hT(a));)if("\x3c"===e[0])if("/"===e[1])c.length&&c[c.length-1]===e.substr(2).replace("\x3e","")&&(c.pop(),d=d.parentNode);else{if(e=e.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/)){var f=e[1];var g=e[3];var h=eU[f];h?(h=_.wq(h),(f=fU[f])&&g&&h.setAttribute(f,g.trim()),g=h):g=null;!g||gU[g.localName]&&gU[g.localName]!==d.localName||(e[2]&&(g.className=e[2].substr(1).replace(/\./g," ")),c.push(e[1]),d.appendChild(g),
d=g)}}else d.appendChild(document.createTextNode(jT(e)));return b};var eU={c:"c",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"v",lang:"lang"},fU={v:"voice",lang:"lang"},gU={rt:"ruby"},iT={"\x26amp;":"\x26","\x26lt;":"\x3c","\x26gt;":"\x3e","\x26lrm;":"\u200e","\x26rlm;":"\u200f","\x26nbsp;":"\u00a0"};xT.prototype.init=function(){this.j=!0};xT.prototype.A=function(){return!1};_.x(yT,xT);yT.prototype.A=function(){return!this.h&&!(this.f.region&&this.f.region.displayAlign)};
yT.prototype.init=function(a){xT.prototype.init.call(this,a);if(this.h)_.uq(this.a,"clpp-text-cue-image"),this.a.style.backgroundImage='url("'+this.f.backgroundImage+'")',this.l.stretchSmpteImage&&(this.a.style.backgroundSize="contain");else if(a){var b=this.f;if(b.payloadType===_.pg){var c=_.wq(_.Wd);c.innerHTML=b.payload;b=c}else b.payloadType===_.Kg?b=(new gT).parse(b.payload):(c=_.wq(_.Wd),c.textContent=b.payload,b=c);_.uq(b,this.w);this.id&&(b.id=this.id);c=_.w(this.f.cssClassList);for(var d=
c.next();!d.done;d=c.next())_.uq(b,d.value);kT({writingMode:IT(this)},b);this.a.appendChild(b);_.uq(this.a,"clpp-text-wrapper");c=_.w(this.f.cssClassList);for(d=c.next();!d.done;d=c.next())_.uq(this.a,"clpp-text-wrapper__"+d.value);_.M.R(this.f.line)&&(this.f.lineInterpretation=_.Ei,this.f.line=zT(this)?-1:0);c=IT(this);kT({writingMode:c,webkitWritingMode:c,direction:cT,textAlign:GT(this)},this.a);if(!this.f.region||!this.f.region.displayAlign){c=FT(this,HT(this));d=ET(this,c,null);var e=DT(this,
c,null),f=CT(this)&&_.M.R(null)?mT(0,_.If):cT;kT({position:"absolute",left:d,right:f,top:e,width:zT(this)?mT(this.f.size,"%"):cT,height:BT(this)||CT(this)?mT(this.f.size,"%"):cT},this.a);d=this.f;a=zT(this)?a.height:a.width;e=AT(this);if(d.lineInterpretation===_.Ei)f=e*Math.round(d.line),Math.abs(f)>a&&(f=e*(0>d.line?0:-1)),0>f&&(f+=a);else{f=e/a*100;var g=d.line;switch(d.lineAlign){case _.sd:g-=f/2;break;case _.le:g-=f}f=Math.round(g/100*a)}CT(this)&&(f=a-f-e);a=f;d=ET(this,c,a);e=CT(this)&&_.M.R(a)?
mT(0,_.If):cT;kT({left:d,right:e,top:DT(this,c,a)},this.a)}lT(this.C,b)}};yT.prototype.o=function(){return _.wq(_.Wd)};JT.prototype.append=function(a){var b=a.a;b.style.visibility=_.te;this.f.appendChild(b);a.j||a.init(this.a);if(a.A()){a:{var c=tT(a.a);var d=KT(this,a.f),e=AT(a),f=sT(c),g=null,h=0;d=_.w(d);for(var l=d.next();!l.done;l=d.next()){for(l=l.value;wT(c,this.a,l)||vT(c,this.a)&&uT(c,this.h);){var m=c,n=e;switch(l){case "+x":m.left+=n;m.f+=n;break;case "-x":m.left-=n;m.f-=n;break;case "+y":m.top+=n;m.a+=n;break;case "-y":m.top-=n,m.a-=n}}if(this.j||vT(c,this.a))break a;l=this.a;l=Math.max(0,Math.min(c.f,
l.f)-Math.max(c.left,l.left))*Math.max(0,Math.min(c.a,l.a)-Math.max(c.top,l.top))/(c.height*c.width);l>h&&(g=sT(c),h=l);c=sT(f)}c=g||f}kT({top:mT(c.top-this.a.top,_.If),bottom:mT(this.a.a-c.a,_.If),left:mT(c.left-this.a.left,_.If),right:mT(this.a.f-c.f,_.If),height:mT(c.height,_.If),width:mT(c.width,_.If)},a.a)}b.style.visibility="visible";this.h.push(tT(a.a))};_.x(MT,xT);MT.prototype.init=function(){this.h=new JT(this);this.j=!0};MT.prototype.o=function(){var a=_.wq(_.Wd);_.uq(a,this.w);this.id&&(a.id=this.id);return a};_.x(OT,MT);
OT.prototype.init=function(a){a:{var b=this.f;switch(b.widthUnits){case 0:b=b.width;break a;case _.Ii:b=b.width/100*a.width;break a;default:throw Error(ZS);}}var c=this.f;var d=c.viewportAnchorUnits;if(d===_.Ii)c=c.viewportAnchorX/100*a.width-c.regionAnchorX/100*b;else if(0===d)c=c.viewportAnchorX-c.regionAnchorX;else throw Error(ZS);d=a.height;var e=PT(this,d,a.height);kT(this.B,this.a);kT({left:mT(c,_.If),top:mT(e,_.If),width:mT(b,_.If),height:mT(d,_.If)},this.a);this.f.writingMode&&kT({display:"flex",
"flex-direction":this.f.writingMode},this.a);this.f.displayAlign&&kT({"justify-content":this.f.displayAlign},this.a);b=_.w(this.f.cssClassList);for(c=b.next();!c.done;c=b.next())_.uq(this.a,c.value);a:switch(b=this.f,b.heightUnits){case 0:b=b.height;break a;case _.Ii:b=b.height/100*a.height;break a;case 2:b=b.height;d=new yT(new _.Hi(0,1,"Lorem ipsum",_.Bi),{},{});c=d.a;this.a.appendChild(c);d.init(tT(this.a));d=c.getBoundingClientRect().height;this.a.removeChild(c);b*=d;break a;default:throw Error(ZS);
}a=PT(this,b,a.height);kT({top:mT(a,_.If),height:mT(b,_.If)},this.a);this.h=new JT(this,!0);this.j=!0};OT.prototype.getId=function(){return this.f.id};RT.prototype.appendRule=function(a){if(null!=this.a&&!this.l.some(function(c){return c===a})){var b=TT(this,a);if(ST(this,b)){try{this.a.insertRule(b,this.a.cssRules.length),this.g.debug("Added CSS rule "+b)}catch(c){this.g.error("An error occurred when adding a CSS rule: "+b)}this.l.push(a)}else this.g.warn("Stylesheet CLPP Subtitle Styles ignoring the CSS rule because it's not safe: "+b)}};
RT.prototype.destroy=function(){var a=this;return _.I(function(b){if(null==a.a)return b["return"]();a.j.forEach(function(c){return c()});a.j=[];if(null!=a.a){for(;0<a.a.cssRules.length;)a.a.deleteRule(0);a.l=[]}document.head.removeChild(a.a.ownerNode);document.head.removeChild(a.f.ownerNode);a.a=null;a.f=null;a.g.debug("Stylesheet CLPP Subtitle Styles has been destroyed.");_.A(b)})};_.x(XT,_.fv);_.u=XT.prototype;_.u.append=function(a,b){if(null!=this.h&&0!==a.length){for(var c=_.w(b),d=c.next();!d.done;d=c.next())this.h.appendRule(d.value);a.sort(function(e,f){return e.startTime!==f.startTime?e.startTime-f.startTime:e.endTime-f.endTime});this.f=eT(this.f,dT(a));this.l=null;WT(this,!1)}};_.u.Mb=function(){null==this.h||WT(this,!0)};
_.u.destroy=function(){var a=this;return _.I(function(b){if(1==b.a){if(null==a.h)return b["return"]();bU(a);a.G.stop();return _.y(b,a.h.destroy(),2)}a.h=null;a.C.removeChild(a.a.a);a.a=null;a.w.stop();a.w=null;a.j=!1;_.A(b)})};_.u.remove=function(a,b){if(null==this.h)return!1;this.f=this.f.filter(function(c){return c.startTime<a||c.endTime>=b});this.l=null;WT(this,!0);return!0};_.u.isTextVisible=function(){return this.j};
_.u.setTextVisibility=function(a){null!=this.h&&this.j!==a&&((this.j=a)?(this.G.yb(.25),this.L.enableResizeObserver&&this.w.start(),WT(this,!0)):(this.G.stop(),this.w.stop(),bU(this)))};_.u.Vj=function(){WT(this,!0)};_.J(bT,XT);XT.prototype.setTextVisibility=XT.prototype.setTextVisibility;XT.prototype.isTextVisible=XT.prototype.isTextVisible;XT.prototype.remove=XT.prototype.remove;XT.prototype.destroy=XT.prototype.destroy;XT.prototype.append=XT.prototype.append;cU.prototype.a=function(a){return!!a.enableHtmlCue&&!_.yl()};cU.prototype.create=function(a){return new XT(a)};_.x(dU,_.tt);dU.prototype.f=function(){_.tp(_.ue,new cU)};dU.prototype.a=function(){_.rp.has(_.ue)&&(_.rp["delete"](_.ue),_.sp.info("Removed factory: 'html'"))};dU.prototype.id=function(){return _.jg};_.J("clpp.htmlcue.HtmlCueComponent",dU);};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();