(function(){var g={}; var _ = _ || {}
var f=function(window){var aC=function(a){switch(a.type){case 1:return YB;case 2:return ZB;case 3:return $B}},cC=function(a){var b=Object.keys(a).find(function(c){return bC.includes(c.toLowerCase())});return void 0!==b?a[b]:void 0},dC=function(a,b){this.m=a;this.o=this.f=null;this.B=("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6);this.a=new _.Wh;this.g=b;this.A=this.l=this.h=!1;this.w=null;this.j=a.getNetworkEngine();this.G=this.Ek.bind(this);this.C=this.In.bind(this)},fC=function(a){var b={debug:!0,
data:eC(a)};a.f&&a.f.muxOptionsOverride&&_.N.gd(a.f.muxOptionsOverride)&&(b=_.N.qa(b,a.f.muxOptionsOverride));b=_.N.qa(b,{getPlayheadTime:function(){return 1E3*a.m.getPosition()},getStateData:function(){a.g.debug("getStateData()");var c=a.m.getLoadedSource(),d=a.m.getTrackManager(),e=a.m.getSurface(),f={player_is_paused:a.m.isPaused(),player_is_fullscreen:e.isFullscreen(),video_source_duration:1E3*a.m.getDuration(),player_autoplay_on:!!a.m.getConfiguration().autoplay};if(c){var g=new _.Qk(c.url);
f.video_source_url=_.Rk(g);f.video_source_mime_type=c.type;c.name&&(f.video_title=c.name)}if(c=e.getContainer())f.player_width=c.offsetWidth,f.player_height=c.offsetHeight;(c=a.m.getSurface().getMedia())?c={videoWidth:c.videoWidth,videoHeight:c.videoHeight}:(c=a.m.getTrackManager().ka(),c={videoWidth:c.width,videoHeight:c.height});e=c;c=e.videoWidth;e=e.videoHeight;a.g.debug("Video dimensions: "+c+"x"+e);c&&e&&(f.video_source_height=c,f.video_source_width=e);(d=d.oa())&&d.language&&(f.player_language_code=
d.language);return f}});a.g.debug("Mux SDK options",b);return b},eC=function(a){var b={env_key:a.f.envKey,video_title:a.o&&a.o.name||"",player_name:_.ta,player_software_name:_.ta,player_software_version:_.ha,player_mux_plugin_name:"CastlabsPlayer built-in Mux Plugin",player_mux_plugin_version:_.ha};(a=a.m.getConfiguration().viewerId)&&(b.viewer_user_id=a);return b},gC=function(a){a.a.on(a.m,_.qg,function(){var b={player_playhead_time:1E3*a.m.getPosition()};a.emit(_.qg,b)});a.a.on(a.m,_.mf,function(){return a.emit(_.mf)});
a.a.on(a.m,_.gd,a.Bk.bind(a));a.a.on(a.m,_.fg,a.Dk.bind(a));a.a.on(a.m,_.Ag,function(){return a.emit(_.Yf)});a.a.on(a.m,_.zg,function(){return a.emit(_.Xf)});a.a.on(a.m,_.qe,a.Ck.bind(a));a.a.on(a.m,_.rc,function(){return a.emit("adbreakstart")});a.a.on(a.m,_.sc,function(){return a.emit("adbreakend")});a.a.on(a.m,_.Hc,function(){a.emit("adplay");a.emit("adplaying")});a.a.on(a.m,_.Dc,function(){return a.emit("adpause")});a.a.on(a.m,_.Fc,function(){a.emit("adplay");a.emit("adplaying")});a.a.on(a.m,
_.Ic,function(){return a.emit("adended")});a.a.on(a.m,_.wc,function(){return a.emit("adfirstquartile")});a.a.on(a.m,_.Cc,function(){return a.emit("admidpoint")});a.a.on(a.m,_.Jc,function(){return a.emit("adthirdquartile")});a.j.Rc(a.G);a.j.zf(a.C);a.a.on(a.m,_.qe,function(b){var c=b.detail;if(c&&1===c.category&&(b=(b=c.data)&&b.request,void 0!==b&&!0===(1===b.type||2===b.type||3===b.type)))if(7001===c.code){c=b.requestStartTimestamp;var d=new _.Qk(b.uris[b.uriIndex]);b={request_start:c,request_type:aC(b),
request_hostname:d.a};a.g.debug("onRequestCanceled()","Track event: requestcanceled",b);a.emit("requestcanceled",b)}else{d=b.requestStartTimestamp;var e=new _.Qk(b.uris[b.uriIndex]),f=c.data;b={request_start:d,request_type:aC(b),request_hostname:e.a,request_error:""+aC(b)+"LoadError",request_error_code:void 0===f?-1:void 0!==f.response?f.response.status:void 0!==f.status?f.status:-1,request_error_text:c.toString()};a.g.debug("onRequestFailed()","Track event: requestfailed",b);a.emit("requestfailed",
b)}})},hC=function(a){_.Zh(a.a);a.j.me(a.G);a.j.vg(a.C)},iC=function(){this.f=this.m=null;this.a=!1;this.g=new _.K("clpp.muxdata")},jC=function(a){return!_.N.R(a)&&typeof a.init===_.ue&&typeof a.emit===_.ue},kC=function(a,b){a.trigger(new _.L(_.qe,{detail:b}))},lC=function(){},YB="manifest",ZB="media",$B="encryption",bC=["x-request-id","cf-ray","x-amz-cf-id","x-akamai-request-id"];_.u=dC.prototype;_.u.initialize=function(a,b,c){this.f=a;this.o=b;this.w=c;if(!this.h){try{this.h=!0,this.w.init(this.B,fC(this))}catch(d){throw this.h=!1,hC(this),new _.O(1,9,9302,null,d);}this.emit("playerready")}this.l&&!this.A&&(a=eC(this),this.emit("videochange",a),this.l=!1);gC(this)};_.u.release=function(){this.g.debug("release()");this.l?this.g.debug(_.ka):(hC(this),this.l=!0,this.o=this.f=null)};_.u.destroy=function(){this.g.debug(_.Vd);this.A?this.g.debug(_.ja):(this.A=!0,this.emit("destroy"))};
_.u.emit=function(a,b){if(null===this.w)throw new _.O(1,9,9301);this.w.emit(this.B,a,b)};_.u.Bk=function(a){this.g.debug(_.Ye);var b=a.detail;a=this.m.getTrackManager();b&&b.bandwidth&&(b=b.bandwidth,(a=a.Va())&&a.bandwidth&&(b+=a.bandwidth),this.emit("renditionchange",{video_source_bitrate:b}))};_.u.Dk=function(a){this.g.debug(_.cf);switch(a.detail.currentState){case _.gq:this.m.getConfiguration().autoplay&&this.emit(_.mf);break;case _.iq:this.emit(_.xf);break;case _.hq:this.emit(_.hf);break;case _.bq:this.emit(_.pe)}};
_.u.Ck=function(a){this.g.debug(_.$e);if(this.h&&(a=a.detail||null))if(10003===a.code)this.emit("aderror");else if(a.severity===_.P){var b=a.message||"Player error";if(1===a.category||6100===a.code||6007===a.code)b="Download error",6100===a.code?b="Certificate request error":6007===a.code&&(b="License request error"),b=b+" castlabs-error-data:"+JSON.stringify(a.data);this.emit(_.qe,{player_error_code:a.code,player_error_message:b})}};
_.u.Ek=function(a){var b=a.request;if(b=void 0!==b&&!0===(1===b.type||2===b.type||3===b.type))b=a.status,b=void 0!==b&&200<=b&&299>=b;if(b){b=a.request;var c=a.headers,d=b.bytesLoaded,e=b.requestStartTimestamp,f=b.startTime,g=b.endTime,h=e+a.responseStartMs;a=e+a.timeMs;f=f&&g?g-f:void 0;g=new _.Qk(b.uris[b.uriIndex]);a={request_start:e,request_type:aC(b),request_hostname:g.a,request_id:cC(c),request_bytes_loaded:d,request_response_start:h,request_response_end:a,request_response_headers:c,request_media_duration:f,
request_url:_.Rk(g)};this.g.debug("onRequestCompleted()","Track event: requestcompleted",a);this.emit("requestcompleted",a)}};_.u.In=function(a){a.requestStartTimestamp=Date.now()};_.x(iC,_.Gv);_.u=iC.prototype;_.u.onPlayerCreated=function(a){this.m=a;this.f=new dC(a,this.g)};
_.u.onContentWillLoad=function(a,b){var c=a.getConfiguration();c=_.N.cb(c.muxdata);try{var d=[];typeof c===_.Xe&&(c.envKey||d.push("envKey"));if(0<d.length)throw new _.O(1,9,9300,{missingKeys:d});var e=a.getConfiguration();d=null;if(this.a=!_.N.R(e.muxdata)&&typeof e.muxdata===_.Xe){var f=e.muxdata;d=jC(f.muxLib)?f.muxLib:window.mux;if(!jC(d)){this.g.warn("Mux SDK is not loaded. Will do nothing.");this.a=!1;var g=new _.O(1,9,9301);kC(a,g)}}else this.g.debug("Mux plugin is loaded but not configured. Will do nothing.");
var h=d;null!==h&&this.f.initialize(c,b,h)}catch(l){this.a=!1,kC(a,l)}};_.u.onContentLoaded=function(){};_.u.onPlayerWillDestroy=function(){this.a&&(this.f.destroy(),this.m=this.f=null)};_.u.onPlayerWillRelease=function(){this.a&&this.f.release()};_.u.id=function(){return"mux"};_.u.emit=function(a,b){try{this.f.emit(a,b)}catch(c){throw null!==this.m&&kC(this.m,c),c;}};_.J("clpp.muxdata.MuxDataPlugin",iC);iC.prototype.emit=iC.prototype.emit;iC.Id="mux";lC.prototype.create=function(){return new iC};
_.gt(new lC);};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();