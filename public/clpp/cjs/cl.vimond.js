(function(){var g={}; var _ = _ || {}
var f=function(window){var zx="Registering listeners",Ax="clpp.vimond.VimondPlugin",Bx=function(a,b,c,d,e){this.G=a;this.H=b;this.I=c;this.m=d;this.C=e;this.a=new _.Sh;this.l=!0;this.f=this.j=this.A=!1;this.B=null;this.h=new _.pl(this.vh.bind(this));this.g=new _.K("clpp.vimond.VimondDispatcher");this.o=this.w=0;this.m&&this.a&&(this.g.debug(zx),this.a.on(this.m,_.cg,this.Ck.bind(this)),this.a.on(this.m,_.ng,this.Dk.bind(this)),this.a.on(this.m,_.uc,this.Ak.bind(this)),this.a.on(this.m,_.vc,this.Bk.bind(this)))},Cx=function(a,
b){a.m.trigger(new _.L(_.Ig,{detail:b}))},Dx=function(a,b,c){b&&(a.A=!0,a.h.stop());a.m.onError(new _.N(b?_.P:1,9,9201,c))},Ex=function(a,b,c,d,e){this.l=a;this.o=c;this.h=b;this.a=d;this.j=e;this.g=new _.K("clpp.vimond.VimondService");this.f=0},Fx=function(a){this.m=a;this.a=new _.Sh;this.g=new _.K("clpp.vimond.VimondAdapter");this.f=this.h=!1;this.m&&this.a&&(this.g.debug(zx),this.a.on(this.m,_.Lf,this.o.bind(this)),this.a.on(this.m,_.uc,this.j.bind(this)),this.a.on(this.m,_.vc,this.l.bind(this)))},
Gx=function(a,b){var c=a.m.getState();if(1===b)return["str-start",_.tf];if(a.h)return[_.le,_.df];if(c===_.Np)return[_.le,null];if(c===_.Rp)return[_.ne,_.df];var d=_.df;if(c===_.Lp||c===_.Up||a.f)d=_.tf;return["period",d]},Hx=function(){this.a=!1;this.g=new _.K(Ax);this.j=this.h=this.f=null},Ix=function(){};_.u=Bx.prototype;_.u.Dk=function(){this.f||(this.f=1<Math.abs(this.w-this.m.getPosition()));this.w=this.m.getPosition()};_.u.Ak=function(){this.g.debug("Ad break started");this.j=!0};
_.u.Bk=function(){this.g.debug("Ad break stopped");this.j=!1};
_.u.Ck=function(a){var b=this,c,d,e,f,g;return _.I(function(h){if(1==h.a){c=a.detail;d=_.Pp;e=c.currentState;f=c.previousState;b.g.debug("State changed, prev: "+f+" curr: "+e);if(b.A||b.j)return h["return"]();if(e===b.B&&!b.f)return b.g.debug("Ignore transition"),h["return"]();if(b.l&&e!==d.PLAYING)return h["return"]();if(b.f&&[d.PAUSED,d.BUFFERING].includes(e))return b.g.debug("Seeking"),h["return"]();b.f&&e===d.PLAYING&&(b.g.debug("Seeked"),b.f=!1);g=[d.PLAYING,d.PAUSED,d.ERROR,d.ENDED];if(!g.includes(e))return h.F(0);
b.B=e;return _.y(h,b.vh(),3)}e===d.ENDED&&b.h.stop();_.A(h)})};
_.u.vh=function(){var a=this,b,c,d,e,f,g;return _.I(function(h){if(1==h.a){var l=Math.floor(Date.now()/1E3);0<a.o&&a.g.debug("Last event was "+(l-a.o)+" seconds ago");a.o=l;a.h.stop();a.h.ea(a.l?10:a.G);a.l=!1;_.D(h,2);l=a.C;l.f++;var m=_.M.pa(l.o);m.client.buildName=_.va;m.client.buildVersion=_.ja;var n=m.client,p=l.a.m.getDrmInfo();n.drm=p?p.keySystem:"";m.client.pageUrl=document.location.href;m.client.streamUrl=l.a.m.getLoadedSource().url;m.client.userAgent=navigator.userAgent;m.client.videoFormat=
l.a.m.getLoadedSource().type||"";n=m.client;p=l.a.m.getLoadedSource();p=((new _.Jk(p.url)).scheme||"").replace(":","");n.videoProtocol=p;n=Gx(l.a,l.f);m.client.playerEvent=n[0]||"";m.client.playerState=n[1]||"";m.progress.vod&&(m.progress.vod.position=l.a.getPosition());if(n=m.progress.live){p=l.a;var q=p.m.getPresentationStartTime()||0;p=Math.floor(q+p.m.getPosition());p=(new Date(1E3*p)).toISOString();n.position=p;q=l.a;p=q.m.getPosition();q=q.m.getSeekRange().end;n.onLiveEdge=30>Math.abs(q-p);
typeof n.liveResumePossible!==_.id&&(n.liveResumePossible=!0)}m.progress.eventNumber=l.f;m.timestamp=(new Date).toISOString();l.g.debug("Fire an event");n=_.Yj(l.l);n.method=_.Ib;n.contentType="application/json";n.headers.Authorization="Bearer "+l.h;n.body=_.R.ld(JSON.stringify(m));l=l.j.fetch(n).U;return _.y(h,l,4)}if(2!=h.a)return b=h.f,Cx(a,b),_.oh(h,0);d=c=_.E(h);e=d.code;f=d.data;g=[1002,1003];g.includes(e)?(a.g.debug("Unreachable service"),Cx(a,f),Dx(a,a.H,f)):1001===e?(a.g.debug("Generic service error"),
Cx(a,f),Dx(a,a.I,f)):a.g.error(c.toString());_.A(h)})};Ex.prototype.Dg=function(a){this.h=a};Fx.prototype.getPosition=function(){return Math.floor(this.m.getPosition())};Fx.prototype.o=function(){this.h=!0};Fx.prototype.j=function(){this.f=!0};Fx.prototype.l=function(){this.f=!1};_.x(Hx,_.pv);_.u=Hx.prototype;_.u.onPlayerCreated=function(){};
_.u.onContentWillLoad=function(a){var b=a.getConfiguration();(this.a=!_.M.R(b.vimond)&&typeof b.vimond===_.Ue)?a.namespace()===_.Ad&&(this.a=!1,this.g.info("Vimond does not report when casting.")):this.g.debug("Vimond plugin is loaded but not configured. Will do nothing.");if(this.a){b=a.getConfiguration().vimond;for(var c=_.w(["authToken","playerEventRequest"]),d=c.next();!d.done;d=c.next())if(d=d.value,!b[d]){this.g.warn(d+" key is missing");a.onError(new _.N(1,9,9200));return}this.g.debug(_.wa);
c=b.failIfUnreachable;typeof c!==_.id&&(c=!0);d=b.failOnError;typeof d!==_.id&&(d=!0);this.f=new Fx(a);this.h=new Ex(b.playerEventRequest.uri,b.authToken,b.playerEventRequest.body,this.f,a.getNetworkEngine());this.j=new Bx(b.playerEventRequest.eventInterval,c,d,a,this.h)}};_.u.onPlayerWillRelease=function(){if(this.a){if(this.f){var a=this.f;a.g.debug(_.gc);_.Vh(a.a)}this.j&&(a=this.j,a.g.debug(_.gc),_.Vh(a.a),a.h.stop());this.j=this.h=this.f=null}};_.u.onPlayerWillDestroy=function(){};_.u.id=function(){return"vimond"};
_.u.Dg=function(a){this.a&&this.h&&this.h.Dg(a)};_.J(Ax,Hx);Hx.prototype.updateAuthToken=Hx.prototype.Dg;Hx.Id="vimond";Ix.prototype.create=function(){return new Hx};_.Qs(new Ix);};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();