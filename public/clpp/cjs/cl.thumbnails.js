(function(){var g={}; var _ = _ || {}
var f=function(window){var zz="No thumbnail found for position: ",Az="Position is out of range: ",Bz="Thumbnail URL is mandatory",Cz="Wrong gridSize format",Dz="clpp.thumbnails",Ez=function(){this.log=new _.K(Dz);this.player=null;this.a=[];this.w=!1},Gz=function(a,b){b.reduce(function(c,d){var e=d,f=!1;typeof d===_.Xe&&(e=d.step,f=d.preloadWhileBuffering);return c.then(function(){return Fz(a,0,e,!!f)})},Promise.resolve())},Fz=function(a,b,c,d){if(a.w||b>=a.a.length)return Promise.resolve();var e=b+c;return Hz(a,d).then(function(){return a.a[b].load()}).then(function(){return Fz(a,
e,c,d)})},Hz=function(a,b){return new Promise(function(c){if(b||a.player.getState()!==_.$p)c();else a.player.one(_.id,function(){c()})})},Iz=function(a,b,c,d,e,f,g,h,l,m,n,p){d=void 0===d?0:d;e=void 0===e?0:e;f=void 0===f?0:f;g=void 0===g?0:g;h=void 0===h?1:h;l=void 0===l?1:l;m=void 0===m?0:m;n=void 0===n?0:n;p=void 0===p?new Image:p;this.time=b;this.src=a;this.duration=c;this.x=d;this.y=e;this.width=f;this.height=g;this.sa=p;this.$k=h;this.Mn=l;this.Rl=m;this.Sl=n;this.Zf=null},Jz=function(){Ez.call(this);
this.f=null;this.o=this.h=1;this.j=0},Kz=function(a,b){this.time=a;this.duration=0;this.offset=b;this.length=0;this.hd=new _.mk},Lz=function(){this.g=new _.K(Dz);this.f=new ArrayBuffer(0);this.a=[];this.h=new _.mk},Mz=function(a){var b=a.f.byteLength;a.a.forEach(function(c){c.offset+c.length<b&&c.hd.resolve()})},Oz=function(a,b){return Nz(a,b).then(function(c){return new Iz(c,b.time,b.duration)})},Nz=function(a,b){return b.load().then(function(){var c=_.Fj(a.f,b.offset,b.length);return"data:image/jpeg;base64,"+
_.Pj(c)})},Pz=function(){Ez.call(this);this.f=null},Qz=function(a){a=a.split(/\.|:/).map(parseFloat);var b=0,c,d={3:.001,2:1,1:60,0:3600};for(c=a.length-1;0<=c;c--)b+=a[c]*d[c];return b},Rz=function(){Ez.apply(this,arguments)},Sz=function(a,b){var c=a.horizontalTiles||b.horizontalTiles||1,d=a.verticalTiles||b.verticalTiles||1,e=c*d;return{ae:c,Og:d,di:e,durationPerTile:a.durationPerTile||b.durationPerTile||(a.endTime-a.startTime)/e}},Tz=function(){this.g=new _.K(Dz);this.a=this.m=null},Uz=function(a){return a.some(function(b){return 0<
b.thumbStreams.length})},Zz=function(a){return a?a===Vz||a===Wz?new Jz:a===Xz?new Pz:a===Yz?new Lz:null:null},$z=function(a){if(!a)return null;a=new _.Qk(a);return a.path.match(/.*\.vtt$/i)?Xz:a.path.match(/.*\.bif$/i)?Yz:a.path.match(/.*\.(png|jpg|jpeg)$/i)?Vz:null},aA=function(){};Ez.prototype.init=function(a,b){var c=this;this.player=a;a.one(_.Of,function(){c.w=!0});a.isLive()||this.l().then(function(){b&&b.preload&&Gz(c,b.preload)})};Iz.prototype.raw=function(){return this.sa.cloneNode(!1)};
Iz.prototype.element=function(a,b){var c=this.width,d=this.height,e=this.width/this.height;void 0!==a&&void 0===b&&(b=0);null!==a&&void 0!==a&&(c=a);null!==b&&void 0!==b&&(d=b);c||(c=Math.ceil(d*e));d||(d=Math.ceil(c/e));e=document.createElement(_.Xd);e.style.width=c+_.Lf;e.style.height=d+_.Lf;e.style.backgroundColor="#000";e.style.backgroundRepeat="no-repeat";e.style.backgroundImage='url("'+this.src+'")';e.style.backgroundSize=Math.ceil(c/this.width*(this.sa.naturalWidth||this.sa.width))+"px "+Math.ceil(d/
this.height*(this.sa.naturalHeight||this.sa.height))+_.Lf;var f=this.y/this.height;e.style.backgroundPositionX="-"+this.x/this.width*c+_.Lf;e.style.backgroundPositionY="-"+f*d+_.Lf;return e};
Iz.prototype.load=function(){var a=this;this.Zf||(this.Zf=new Promise(function(b,c){function d(){a.width||(a.width=(a.sa.naturalWidth||a.sa.width)/a.$k);a.height||(a.height=(a.sa.naturalHeight||a.sa.height)/a.Mn);a.x||(a.x=a.width*a.Rl);a.y||(a.y=a.height*a.Sl)}if(a.sa.src&&a.sa.complete)d(),b(a);else{var e=null,f=function(){d();a.sa.removeEventListener(_.He,f);a.sa.removeEventListener(_.qe,e);b(a)};e=function(g){a.sa.removeEventListener(_.He,f);a.sa.removeEventListener(_.qe,e);c(new _.O(1,9,2014,
"Failed to load thumbnail.",g))};a.sa.addEventListener(_.He,f);a.sa.addEventListener(_.qe,e);a.sa.src=a.src}}));return this.Zf};_.J("clpp.thumbnails.Thumbnail",Iz);Iz.prototype.load=Iz.prototype.load;Iz.prototype.element=Iz.prototype.element;Iz.prototype.raw=Iz.prototype.raw;_.x(Jz,Ez);
Jz.prototype.init=function(a,b){if(!b||!b.url)throw new _.O(1,9,7100,Bz);if("GRID"===b.mode&&!b.gridSize)throw new _.O(1,9,7100,"Grid size is mandatory for GRID mode");if(!b.duration)throw new _.O(1,9,7100,"Duration is mandatory");this.f=b;this.j=this.f.duration;if(this.f.gridSize)try{var c=this.f.gridSize.split(/x/).map(function(d){return parseInt(d,10)}).filter(function(d){return 0<d});if(2===c.length)this.h=c[0],this.o=c[1];else throw new _.O(1,9,7100,Cz);}catch(d){throw this.log.error("Error during parsing gridSize",d),
new _.O(1,9,7100,Cz);}Ez.prototype.init.call(this,a,b)};Jz.prototype.get=function(a){var b=this,c,d,e,f;return _.I(function(g){if(1==g.a){c=b.player.getDuration();if(0>a||a>c)throw new _.O(1,9,2014,Az+a);d=b.f.duration;e=Math.floor(a/d);f=b.a[e];if(!f)throw new _.O(1,9,2014,"No thumbnail found for position "+a+" at index "+e);return _.y(g,f.load(),2)}return g["return"](f)})};
Jz.prototype.l=function(){if(0<this.a.length)return Promise.resolve();var a=this.player.getDuration(),b=this.h*this.o;a=Math.ceil(Math.ceil(a/this.j)/b);for(var c=this.f.templateKey||"$index$",d=0;d<a;d++)for(var e=this.f.url.replace(c,String(d+1)),f=new Image,g=0;g<b;g++)this.a.push(new Iz(e,this.j*(d*b+g),this.j,0,0,0,0,this.h,this.o,g%this.h,Math.floor(g/this.h),f));return Promise.resolve()};Kz.prototype.load=function(){return this.hd};
Lz.prototype.init=function(a,b){var c=this;if(!b||!b.url)throw new _.O(1,9,7100,Bz);var d=b.url,e=_.ek(d);e.type=_.dk;a.getNetworkEngine().fetch(e).T.then(function(f){f=f.data;var g=_.Fj(c.f);f=_.Fj(f);for(var h=g.byteLength+f.byteLength,l=new ArrayBuffer(h),m=new DataView(l),n=0,p=0,q=g.byteLength;p<q;p++)m.setUint8(n,g[p]),n+=1;g=0;for(p=f.byteLength;g<p;g++)m.setUint8(n,f[g]),n+=1;c.f=l;c.g.info("Appended "+f.byteLength+" bytes.Total data now "+(h+" bytes."));l=c.f;f=_.Fj(l);n=String.fromCharCode.apply(null,
bA);g=Array.prototype.slice.call(f,0,8);f=64;h=0;m=!1;if(n===String.fromCharCode.apply(null,g))for(l=new DataView(l,16,20),l=l.getUint32(0,!0),0===l&&(l=1E3);!m;){h+=1;g=l;n=new DataView(c.f,f);m=n.getUint32(0,!0);g=m*g/1E3;n=n.getUint32(4,!0);n=new Kz(g,n);if(g=c.a.length)g=c.a[g-1],g.length=n.offset-g.offset,g.duration=n.time-g.time;c.a.push(n);f+=8;(m=4294967295===m)&&c.h.resolve();if(1E5<h)throw Error("There was a problem during reading BIF entries");}else throw Error("The file is not a valid BIF format");
Mz(c)})["catch"](function(f){c.g.error("[BIF] Error while loading thumbnails '\n            + 'URL: "+d,f);a.onError(new _.O(1,9,2013,"Error while loading and parsing BIF thumbnails.",f))})};Lz.prototype.get=function(a){var b=this,c,d;return _.I(function(e){switch(e.a){case 1:if(0>a)throw new _.O(1,9,2014,Az+a);return _.y(e,b.h,2);case 2:c=b.a.find(function(f){return a>=f.time&&a<f.time+f.duration});if(!c)throw new _.O(1,9,2014,zz+a);return _.y(e,Oz(b,c),3);case 3:return d=e.f,_.y(e,d.load(),4);case 4:return e["return"](d)}})};
Lz.prototype.yc=function(){return 0<this.a.length};var bA=[137,66,73,70,13,10,26,10];_.x(Pz,Ez);
Pz.prototype.init=function(a,b){var c=this;if(!b||!b.url)throw new _.O(1,9,7100,Bz);var d=b.url,e=_.ek(d);e.type=_.dk;this.f=a.getNetworkEngine().fetch(e).T.then(function(f){f=f.data;if(!f)throw Error("No data in the response");f=_.T.$(f).split(/\n/);for(var g=0;g<f.length;g++){var h=f[g],l=h.split(" --\x3e ");if(2===l.length){h=f[++g];var m=h.indexOf("\x3d"),n=0>m?[]:h.substr(m+1).split(/,/).map(parseFloat);m=n[0];var p=n[1],q=n[2];n=n[3];var t=h.indexOf("#");h=0>t?h:h.substr(0,t);h.match(/^http|^\/\//)||(h=
d.substr(0,d.lastIndexOf("/"))+"/"+h);t=Qz(l[0]);l=Qz(l[1])-t;c.a.push(new Iz(h,t,l,m,p,q,n,0,0))}}})["catch"](function(f){c.log.error("[VTT] Error while loading thumbnails URL: "+d,f);a.onError(new _.O(1,9,2013,"Error while loading VTT thumbnails.",f))});Ez.prototype.init.call(this,a,b)};
Pz.prototype.get=function(a){var b=this,c;return _.I(function(d){if(1==d.a){if(0>a)throw new _.O(1,9,2014,Az+a);return _.y(d,b.f,2)}if(3!=d.a){c=b.a.find(function(e){return a>=e.time&&a<e.time+e.duration});if(!c)throw new _.O(1,9,2014,zz+a);return _.y(d,c.load(),3)}return d["return"](c)})};Pz.prototype.l=function(){return this.f};_.x(Rz,Ez);
Rz.prototype.get=function(a){function b(){return new _.O(1,9,2014,zz+a)}var c=this,d,e,f,g,h,l,m,n,p,q,t,v,z;return _.I(function(A){if(1==A.a){if(0>a)throw c.log.error("Position must be greater than 0 but is "+a),new _.O(1,9,2014,Az+a);d=c.player.getPeriods();for(var G=null,E=_.w(d),C=E.next();!C.done;C=E.next())C=C.value,C.startTime<=a&&(G=C);e=G;if(!e)throw c.log.error("Could not find period for specified position",a),b();f=e.thumbStreams.sort(c.f)[0];if(!f)throw c.log.error("Could not find thumb stream for specified position",a),
b();g=f.findSegmentPosition(a-e.startTime);if(null===g||void 0===g)throw c.log.error("Could not find segment index for specified position",a),b();h=f.getSegmentReference(g);if(!h)return A.F(2);l=Sz(h,f);m=Math.floor((a-h.startTime)/l.durationPerTile);0<c.a.length?(p=f.findSegmentPosition(0),null!==p&&(n=c.a[(g-p)*l.di+m])):(q=h.Xa())&&0<q.length&&(v=t=0,z=h.startTime,1<l.di&&(t=m%l.ae,v=Math.floor(m/l.ae),z+=m*l.durationPerTile),n=new Iz(q[0],z,l.durationPerTile,void 0,void 0,void 0,void 0,l.ae,l.Og,
t,v));return n?_.y(A,n.load(),4):A.F(2)}if(2!=A.a)return A["return"](n);c.log.error("segment reference for specified segment index does not exist",g);throw b();})};Rz.prototype.f=function(a,b){return void 0!==a.bandwidth&&void 0!==b.bandwidth?a.bandwidth-b.bandwidth:0};
Rz.prototype.l=function(){if(0<this.a.length)return Promise.resolve();var a=this.player.getPeriods();a=_.w(a);for(var b=a.next();!b.done;b=a.next())if(b=b.value.thumbStreams.sort(this.f)[0])for(var c=b.findSegmentPosition(0),d=void 0;null!==c&&!_.N.R(d=b.getSegmentReference(c++));)for(var e=Sz(d,b),f=d.Xa()[0],g=new Image,h=d.startTime,l=0;l<e.Og;++l)for(var m=0;m<e.ae;++m)this.a.push(new Iz(f,h,e.durationPerTile,void 0,void 0,void 0,void 0,e.ae,e.Og,m,l,g)),h+=e.durationPerTile;return Promise.resolve()};_.u=Tz.prototype;_.u.onPlayerCreated=function(a){this.m=a};_.u.onPlayerWillDestroy=function(){this.m=null};_.u.onPlayerWillRelease=function(){this.a=null};
_.u.onContentWillLoad=function(a){var b=this,c=a.getConfiguration().thumbnails;if(c)if(!1===c.enabled)this.g.info("Thumbnails disabled.");else{var d=c.mode||null;d||(d=$z(c.url||null));(this.a=Zz(d))?(this.g.info("Loading thumbs configuration",c),this.m.one(_.Ke,function(){b.g.info("Initialize thumbnails provider");try{b.a.init(a,c)}catch(e){b.m.onError(e)}})):this.g.warn("Unknown thumbnail mode",d)}else this.a=null};
_.u.onContentLoaded=function(a,b){for(var c=1;c<arguments.length;++c);if(!this.a&&(c=(c=a.getConfiguration())&&c.thumbnails,!c||void 0===c.enabled||c.enabled)){var d=a.getPeriods();if(Uz(d)){this.a=new Rz;try{this.a.init(a,c)}catch(e){this.m.onError(e)}}}};_.u.get=function(a){return this.a?this.a.get(a):Promise.reject(new _.O(1,9,2014,"Thumbnail format is not supported"))};_.u.id=function(){return"thumbnails"};_.J("clpp.thumbnails.ThumbnailsPlugin",Tz);Tz.prototype.get=Tz.prototype.get;Tz.Id="thumbnails";
aA.prototype.create=function(){return new Tz};_.gt(new aA);var Vz="SINGLE",Wz="GRID",Xz="WEBVTT",Yz="BIF";};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();