(function(){var g={}; var _ = _ || {}
var f=function(window){var TP="An unknown error occurred while trying to get volume",UP="Cannot get loading rendition due to platform limitations",VP="PARAM_START_POSITION",WP="SecurityError",XP="The require privilege is: http://tizen.org/privilege/tv.audio",YP="|STARTBITRATE\x3d",ZP=function(a,b,c){function d(e){c.call(a,e);a.removeEventListener(b,d)}a.addEventListener(b,d)},$P=function(a,b){this.h=a;this.o=null;this.a=_.We;this.l=null;this.j=!1;this.f=new Map;this.D=b;this.g=new _.K("clpp.tizen.DrmEngine")},cQ=function(a){var b,
c,d;return _.I(function(e){if(1==e.a){b=a.a===_.Od||a.a===_.Md;if(!b)throw new _.O(_.P,6,6001,"The key system "+a.a+" is not supported by the player or the platform");c=a.f.get(a.a);if(!c.je)throw new _.O(_.P,6,6012,"No license server given for "+a.a);_.D(e,2);return a.a===_.Od?_.y(e,aQ(a),5):_.y(e,bQ(a,c),5)}if(2!=e.a)return a.o={keySystem:a.a,licenseServerUri:c.je,distinctiveIdentifierRequired:!1,persistentStateRequired:c.og,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:[],
keyIds:[],periodId:null},_.sh(e,0);d=_.F(e);a.g.error("Error while configuring CDM for "+a.a,d);throw new _.O(_.P,6,6005,{message:JSON.stringify(d)});})},bQ=function(a,b){var c,d,e,f;return _.I(function(g){c=dQ;d=eQ;e={};e[d.lj]=!b.og;e[d.nj]=b.je;""!==b.customData&&(e[d.jj]=b.customData);f=JSON.stringify(e);a.g.debug("PlayReady properties: ",f);try{webapis.avplay.setDrm(c.PLAYREADY,"SetProperties",f)}catch(h){throw h;}_.B(g)})},aQ=function(a){var b;return _.I(function(c){b=dQ;try{webapis.avplay.setDrm(b.Ae,
"Initialize",""),webapis.avplay.setDrm(b.Ae,"widevine_app_session",a.l.id),webapis.avplay.setDrm(b.Ae,"widevine_data_type",a.l.type)}catch(d){throw d;}_.B(c)})},fQ=function(a,b){var c,d,e,f,g,h,l,m,n,p,q,t,v,z,A,G,E;_.I(function(C){if(1==C.a){c=dQ;d=a.f.get(a.a);a.g.debug("DRM Challenge data: ",b.challenge);e=atob(b.challenge);f=new Uint8Array(e.length);for(g=0;g<e.length;++g)f[g]=e.charCodeAt(g);h=b.serverurl&&""!==b.serverurl?b.serverurl:d.je;l=_.ek([h],_.ak());l.type=3;l.body=f.buffer;l.method=
_.Fb;_.D(C,2);return _.y(C,a.D.tb.fetch(l).T,4)}if(2!=C.a){m=C.f;if(a.j){n=_.Fj(m.data);p=n.byteLength;q="";for(t=0;t<p;t++)q+=String.fromCharCode(n[t]);v=btoa(q);z=b.session_id+VP+(v+VP);a.g.debug("Widevine license params",z);try{webapis.avplay.setDrm(c.Ae,"widevine_license_data",z)}catch(H){a.g.error("License response rejected by CDM"),A=new _.O(_.P,6,6008,{browserError:JSON.stringify(H)}),a.D.onError(A)}}return _.sh(C,0)}G=_.F(C);a.g.error("License request failed.",JSON.stringify(G));E=new _.O(_.P,
6,6007,{message:"Error while fetching license!",url:G.data.url,status:G.data.status||NaN,response:G.data.response||"",headers:G.data.headers||{}},G);a.D.onError(E);_.B(C)})},gQ=function(a){this.m=a;this.a=this.m.a;this.f=_.Vp;this.j=_.Wp;this.w=(new Date).getTime();this.l=!1;this.o=-1;this.h=2;this.g=new _.K("clpp.tizen.StateManager")},iQ=function(a,b){if(a.f!==b)if(a.f===_.fq&&b!==_.Vp)a.g.debug(_.aD+hQ(b));else{var c=(new Date).getTime();a.j=a.f;a.f=b;a.f===_.$p?(a.o=(new Date).getTime(),a.m.trigger(new _.L(_.jd,
{detail:{bufferedTimeMS:-1,reason:a.h}}))):a.j===_.$p&&a.m.trigger(new _.L(_.id,{detail:{bufferedTimeMS:c-a.o,reason:a.h}}));var d={currentState:a.f,previousState:a.j,timeSinceLastStateChangeMS:c-a.w};a.w=c;a.m.trigger(new _.L(_.fg,{detail:d}));a.g.debug("State changed:",hQ(a.j),"-\x3e",hQ(a.f))}},hQ=function(a){return Object.keys(_.dq)[a]},lQ=function(a){if(a.l){var b=a.a.getState(),c=a.f;switch(b){case jQ:c=_.iq;break;case kQ:c=_.hq;break;default:a.m.isEnded()?c=_.bq:a.g.debug("Inconsistent AVPlay playback state:",
b)}iQ(a,c)}},mQ=function(){this.o=this.A=this.f=this.h=this.B=this.m=this.j=this.a=null;this.C=!1;this.w=!0;this.l=null;this.g=new _.K("clpp.tizen.TextStreamer")},nQ=function(a){if(!a)return!1;a=a.periods;for(var b=!1,c=0;c<a.length;c++)b=b||0<a[c].textStreams.length;return b},oQ=function(a){var b,c;return _.I(function(d){if(1==d.a)return b=a.m.getConfiguration(),c=null,_.y(d,_.Gu(a.B.url,a.m.getNetworkEngine(),b.manifest.attemptParameters,a.B.type||null),2);(c=d.f)&&c.configure(b.manifest);return d["return"](c)})},
pQ=function(a){var b=document.createElement(_.r),c=new _.IG,d=new _.oE,e=a.m.getTextDisplayer();return new _.KG(b,c,e,d,a.m.getConfiguration())},qQ=function(a){var b={configuration:{},Rb:function(){return a.m.getPosition()},V:a.h,tb:a.m.getNetworkEngine(),Yc:null,eg:a.Tk.bind(a),dg:a.Sk.bind(a),onError:a.Uk.bind(a),Bi:function(){},onEvent:function(){},Gi:a.Vk.bind(a),af:function(){},Ud:function(){return new _.lH},Cf:function(){return!1},Od:null};return new _.gI(a.a,b)},rQ=function(a){var b=a.m.getPosition(),
c=null;a=_.w(a.a.periods);for(var d=a.next();!d.done;d=a.next())d=d.value,d.startTime<=b&&(c=d);return c},sQ=function(a){a.g.debug("getTextStreams()",a.a);if(a.a){var b=[],c=a.a.periods;a.g.debug("getting text streams");for(var d=0;d<c.length;d++)if(a.g.debug(c[d].startTime,a.m.getPosition()),c[d].startTime<=a.m.getPosition()){b=c[d].textStreams;break}a=b}else a=[];b=[];for(d=c=0;d<a.length;d++){var e=new _.Gk(String(c++),_.U);e.mimeType=a[d].mimeType;e.language=a[d].language;e.roles=a[d].roles;e.kind=
a[d].kind||_.JD;var f=new _.Pk(String(a[d].id),e);f.bandwidth=a[d].bandwidth||null;e.renditions.push(f);b.push(e)}return b},tQ=function(a){if(a.h&&!a.h.getTextDisplayer().isTextVisible())return null;if(a.f){var b=_.jI(a.f,_.Q),c=null;if(b){a=sQ(a);for(var d=0;d<a.length;d++)if(a[d].renditions[0].id===String(b.id)){c=a[d].renditions[0];break}}return c}return null},uQ=function(a,b){a.g.debug("Set active track",b);if(b&&(a.o=b.language,a.A=b.roles[0]||"",a.C=b.kind===_.se,a.a&&a.f)){a.setTextVisibility(!0);
var c=rQ(a),d=b.renditions[0];(c=c.textStreams.find(function(e){return String(e.id)===d.id}))?(a.w?(a.g.debug("Switching period defer text selection"),a.l=c):(_.uI(a.f,c,!0,0),a.m.trigger(new _.L(_.qm))),a.o=c.language):a.g.error(_.ZC,d.id)}},vQ=function(){this.h=this.a=this.m=null;this.f={};this.g=new _.K("clpp.tizen.TrackManager");this.w=this.l=this.j=null;this.A=!1;this.o=1},wQ=function(a,b){a.m.trigger(new _.L(_.Lg,{details:{width:b.width,height:b.height,bandwidth:b.bandwidth,track:b.track,abrSelection:a.a.o}}))},
xQ=function(a){var b=a.ka();b&&a.m.trigger(new _.L(_.gd,{detail:{width:b.width,height:b.height,bandwidth:b.bandwidth,rendition:b}}))},yQ=function(a){var b=a.m.getConfiguration(),c=_.zi(b.preferredAudioLanguage||[]),d=a.f[_.Ik]||[];if(d.length){var e=null;c.some(function(g){e=_.fE(g,d.map(function(h){return h.language}));return!!e});if(e){var f=d.filter(function(g){return g.language===e});c=f[0];1<f.length&&b.preferredAudioRole&&(f=f.filter(function(g){return 0<=g.roles.indexOf(b.preferredAudioRole)}),
0<f.length&&(c=f[0]));a.g.debug("Setting audio track with preferred language:",e);a.Fa(c)}else a.g.debug("Preferred language(s) not available")}else a.g.debug("Could not set preferred audio language")},CQ=function(a,b){if(b){var c=b.track.type.toUpperCase();zQ(a.a,c,Number(b.id)).then(function(){c===AQ&&(a.j=b,a.m.trigger(new _.L(_.pm)));c===BQ&&(a.l=b,a.m.trigger(new _.L(_.qm)))})["catch"](function(){a.g.error("Could not select "+c+" track.")})}else a.g.debug("Must provide valid rendition")},DQ=
function(a,b,c){var d=_.wj(b.language||_.ug);c.language=_.Hk(d);c.originalLanguage=d;c.channelsCount=b.channels?Number(b.channels):null;c.mimeType=_.cd;a=new _.Pk(String(a),c);a.track=c;a.codec=b.fourCC||null;a.bandwidth=b.bit_rate||null;return a},EQ=function(a,b,c){c.mimeType=_.Jg;a=new _.Pk(String(a),c);a.track=c;a.width=b.Width||null;a.height=b.Height||null;a.bandwidth=b.Bit_rate?Number(b.Bit_rate):null;a.codec=b.fourCC||null;return a},FQ=function(a,b,c){b=_.wj(b.track_lang||_.ug);c.mimeType="text/ttml";
c.language=_.Hk(b);c.originalLanguage=b;c.kind=_.JD;return new _.Pk(String(a),c)},GQ=function(a,b){var c=null;try{c=JSON.parse(b)}catch(d){a.g.warn("Couldn't retrieve extra infos from stream."),c=null}return c},JQ=function(a,b){function c(n,p){for(var q=0;q<n.length;q++)if(n[q].language===p)return n[q];return null}var d={};if(0>=b.length)return d;for(var e=b.filter(function(n){return n.type===HQ}),f=b.filter(function(n){return n.type===AQ}),g=[],h=0;h<f.length;h++){var l=GQ(a,f[h].extra_info);if(l){var m=
_.wj(l.language||_.ug);m=_.Hk(m);m=c(g,m);m||(m=new _.Gk(String(a.o++),_.Ik),g.push(m));m.renditions.push(DQ(f[h].index,l,m))}else a.g.warn("Skipping audio stream with no extra info")}f=new _.Gk(String(a.o++),_.Jk);for(h=0;h<e.length;h++)(l=GQ(a,e[h].extra_info))?f.renditions.push(EQ(e[h].index,l,f)):a.g.warn("Skipping video stream with no extra info");e=[];e=a.h?sQ(a.h):IQ(a,b);d[_.Jk]=[f];d[_.Ik]=g;d[_.U]=e;return d},IQ=function(a,b){for(var c=b.filter(function(h){return h.type===BQ}),d=[],e=0;e<
c.length;e++){var f=GQ(a,c[e].extra_info);if(f){var g=new _.Gk(String(a.o++),_.U);g.renditions.push(FQ(c[e].index,f,g));d.push(g)}else a.g.warn("Skipping text stream with no extra info")}return d},KQ=function(a,b){for(var c=a.f[_.Jk]||[],d=[],e=0;e<c.length;e++)for(var f=0;f<c[e].renditions.length;f++)_.N.na(c[e].renditions[f],b,Object.keys(b))&&d.push(c[e].renditions[f]);return d[0]||null},LQ=function(a,b,c){a=a.f[c]||[];b=String(b.index);c=null;for(var d=0;d<a.length;d++)for(var e=0;e<a[d].renditions.length;e++)if(a[d].renditions[e].id===
b){c=a[d].renditions[e];break}return c},NQ=function(a,b){if(b===_.U&&a.h)return tQ(a.h);var c=MQ(a.a)||[];if(0===c.length)return null;c=c.filter(function(e){return e.type===b.toUpperCase()})[0];var d=null;b===_.Jk&&(d=GQ(a,c.extra_info),d=KQ(a,{width:d.Width,height:d.Height}));b===_.Ik&&(c?(d=LQ(a,c,_.Ik),a.j=d):d=a.j);b===_.U&&(c?(d=LQ(a,c,_.U),a.l=d):d=a.l);return d},OQ=function(a){_.wm.call(this);this.m=a;this.h=null;this.g=new _.K("clpp.tizen.Middleware");this.C=1;this.B=!1;this.l=null;this.G=
0;this.o=!0;this.f=!1;this.a=null;this.A=1;this.w=!1;this.j={}},PQ=function(a){return _.I(function(b){tizen.systeminfo.getPropertyValue("DISPLAY",function(c){a.A=c.resolutionWidth/1920;a.g.debug("Display resolution ratio: ",a.A)},function(c){a.g.debug("Could not load DISPLAY property");throw c;});_.B(b)})},RQ=function(a){try{webapis.avplay.setListener({onbufferingstart:a.Nk.bind(a),onbufferingprogress:a.Mk.bind(a),onbufferingcomplete:a.Lk.bind(a),onstreamcompleted:a.Qk.bind(a),oncurrentplaytime:function(b){a.trigger(new _.L(QQ,
{currentTime:b}))},onevent:a.Pk.bind(a),onsubtitlechange:a.Rk.bind(a),ondrmevent:a.Ok.bind(a),onerror:a.Hd.bind(a)})}catch(b){a.g.error(b)}},SQ=function(a){var b=!!a.m.getTrackManager().Sa();try{webapis.avplay.setSilentSubtitle(!b)}catch(c){a.g.debug("Could not set AVPlay subtitle config",c)}},TQ=function(a,b){try{var c=b.estimatedBandwidth||0,d=b.currentBandwidth||0;a.g.debug({estimatedBandwidth:c,Jo:d});0!==c&&0!==d&&c>=1.15*d&&webapis.avplay.setStreamingProperty("ADAPTIVE_INFO",YP+d)}catch(e){a.g.debug(e)}},
UQ=function(a,b){try{webapis.avplay.setStreamingProperty("ADAPTIVE_INFO","|BITRATES\x3d"+b+YP+b)}catch(c){throw a.g.debug("Could not set fixed bandwidth",c),c;}},XQ=function(a){return{position:a.getPosition(),state:a.m.getState(),Zg:a.getState(),playbackRate:a.getPlaybackRate(),isLive:a.isLive(),duration:a.getDuration(),isMuted:VQ(a),volume:a.getVolume(),eo:WQ(a),gl:MQ(a)}},ZQ=function(a){var b,c;return _.I(function(d){if(1==d.a)return _.y(d,YQ(),2);if(3!=d.a)return b=new Promise(function(e){(new _.xl(e)).ca(5)}),
_.y(d,Promise.race([PQ(a).then(function(){return!0}),b.then(function(){return!1})]),3);c=d.f;if(!c)return a.g.debug("Took to long for the SDK to be ready"),d["return"](Promise.reject("SDK Timeout"));_.B(d)})},eR=function(a,b,c){var d,e,f,g,h,l,m,n;return _.I(function(p){switch(p.a){case 1:a.l=_.mq(b);d=a.G;e=c||{estimatedBandwidth:0,currentBandwidth:0,nextBandwidth:null,currentPosition:0};a.g.debug("Loading manifest URL: "+a.l[d].url);f=b.startTime||void 0;a.f&&(a.trigger(new _.L($Q)),f=c.currentPosition);
_.D(p,2);g=a.l[d].url;h=a.l[d].type;h!==_.Sc||g.includes(".mpd")||(l=new URL(g),l.searchParams.append("cl-ext",".mpd"),g=l.toString());webapis.avplay.open(g);e.nextBandwidth?(UQ(a,e.nextBandwidth),a.o=!1):(a.o||TQ(a,e),a.o=!0);RQ(a);if(!b.drm||!b.drm.env){a.g.debug("No DRM configuration was provided. Assuming clear content");p.F(4);break}m={onError:function(q){return a.m.onError(q)},tb:a.m.getNetworkEngine()};a.h=new $P(b.drm,m);return _.y(p,a.h.init(),4);case 4:return a.f||a.trigger(new _.L(aR)),
_.y(p,bR(a),6);case 6:a.f||a.trigger(new _.L(cR));f&&typeof f===_.k&&0<f&&a.seek(f)["catch"](function(q){a.g.debug("Couldn't set start position",q)});a.f||(b.volume&&a.setVolume(b.volume),b.muted&&dR(a,b.muted),b.autoplay&&a.m.play()["catch"](function(q){a.g.debug("Autoplay failed",q)}));_.sh(p,0);break;case 2:throw n=_.F(p),a.g.debug("Error while attempting to load source."),n;}})},bR=function(a){return _.I(function(b){a.g.debug("avplay.prepare()");return b["return"](new Promise(function(c,d){try{webapis.avplay.prepareAsync(function(){a.g.debug("AVPlay is ready!");
SQ(a);c()},function(e){a.g.debug("prepareAsync failed",e);d(e)})}catch(e){a.g.debug("Failed to prepare media player for playback"),d(e)}}))})},fR=function(a,b,c){a.g.debug("switchVideoTrack()");try{var d={estimatedBandwidth:parseInt(webapis.avplay.getStreamingProperty("CURRENT_BANDWITH"),10),currentBandwidth:b,nextBandwidth:c,currentPosition:a.getPosition()};a.a=XQ(a);a.f=!0;webapis.avplay.stop();webapis.avplay.close();return a.load(a.m.getConfiguration(),d).then(function(){var e=a.a.Zg;a.f=!1;a.a=
null;return e===kQ?a.pause():a.play()})}catch(e){return Promise.reject(e)}},WQ=function(a){return a.f&&a.a?a.a.eo:webapis.avplay.getTotalTrackInfo()},MQ=function(a){return a.f&&a.a?a.a.gl:webapis.avplay.getCurrentStreamInfo()},zQ=function(a,b,c){b=b.toUpperCase();b===BQ&&gR(a,!0);var d=a.j[b];d&&(d.hf.stop(),a.j[b]=null,a.g.debug("Cancelled pending track switch for "+b));return new Promise(function(e,f){function g(h,l,m){m=void 0===m?!1:m;try{webapis.avplay.setSelectTrack(h,l),a.j[h]=null,e()}catch(n){a.g.debug("Could not set "+
h+" track. Trying again...AVPlay state: "+(a.getState()+", buffering: ")+a.w,n),!1===m&&(a.j[h]={type:h,index:l,Wg:0,hf:new _.xl(function(){return g(h,c,!0)})}),(l=a.j[h])&&3>l.Wg?(!a.w&&++l.Wg,l.hf.ca(a.w?.5:.25)):(a.g.debug("Could not set track after multiple attempts.Giving up..."),l&&l.hf.stop(),a.j[h]=null,f())}}g(b,c)})},gR=function(a,b){var c=a.m.getTextDisplayer();c&&c.setTextVisibility(b);c=a.m.h;try{c||webapis.avplay.setSilentSubtitle(!b)}catch(d){a.g.debug("Could not set text track visibility",
d)}},dR=function(a,b){try{tizen.tvaudiocontrol.setMute(b)}catch(c){switch(c.name){case WP:a.g.warn("The application does not have the privilege to set mute.",XP);break;default:a.g.warn(TP,c)}}},VQ=function(a){var b=null;try{b=tizen.tvaudiocontrol.isMute()}catch(c){switch(c.name){case WP:a.g.warn("The application doesn't have the privilege to get the mute state.",XP);break;default:a.g.warn(TP,c)}}return!!b},YQ=function(){return new Promise(function(a,b){if(window.webapis)a();else{var c=document.createElement("script");
ZP(c,_.He,function(d){return a(d)});ZP(c,_.qe,function(d){return b(d)});c.src="$WEBAPIS/webapis/webapis.js";document.querySelector("head").appendChild(c)}})},hR=function(){_.wm.call(this);this.a=new OQ(this);this.f=new gQ(this);this.configuration=this.B=_.Cm();this.w=null;this.g=new _.K("clpp.tizen.Player");this.j=null;this.l=new vQ;this.C=new _.Ak;this.o=this.h=null;this.A=!1},iR=function(a){if("NONE"!==a.a.getState()){var b=a.j.getBoundingClientRect();a=a.a;var c=Math.floor(b.left*a.A),d=Math.floor(b.top*
a.A),e=Math.floor(b.width*a.A);b=Math.floor(b.height*a.A);a.g.debug("Setting display area to","x:",c,"y:",d,"width:",e,"height:",b);webapis.avplay.setDisplayRect(c,d,e,b);0===c&&0===d&&1920===e&&1080===b&&webapis.avplay.setDisplayMethod("PLAYER_DISPLAY_MODE_LETTER_BOX")}else a.g.debug("Could not apply dimension. Player state "+a.a.getState())},jR=function(){},kR=function(){};
$P.prototype.init=function(){var a=this,b,c,d,e,f,g;return _.I(function(h){if(1==h.a){b=_.Wm[a.h.env]||null;if(!b)throw a.g.debug(_.xa,_.Lb+a.h.env+_.aa),new _.O(_.P,6,6015,_.ya+a.h.env+"' is missing.");a.l={id:String(Math.floor(1E4*Math.random())),type:"MPEG-DASH"};c=Object.keys(a.h.customData||{}).length?btoa(JSON.stringify(a.h.customData)):"";d=_.Ym(b,a.h.customData);(e=d[_.Md])&&a.f.set(_.Md,{je:e.licenseUrl||"",customData:c,og:!1});(f=d[_.Od])&&a.f.set(_.Od,{je:f.licenseUrl||"",customData:c,
og:!1});if(0===a.f.size)throw new _.O(_.P,6,6E3);if((g=a.h.preferredDrmSystem)&&a.f.get(g))a.a=g;else if(a.f.get(_.Md))a.a=_.Md;else if(a.f.get(_.Od))a.a=_.Od;else throw new _.O(_.P,6,6001,"Configuration for the target system is missing.");return _.y(h,cQ(a),2)}a.j=!0;_.B(h)})};$P.prototype.release=function(){var a=this;return _.I(function(b){a.j=!1;a.o=null;a.a=_.We;a.l=null;a.f=new Map;_.B(b)})};$P.prototype.getDrmInfo=function(){return this.o};
var eQ={lj:"DeleteLicenseAfterUse",nj:"LicenseServer",uo:"GetChallenge",vo:"HttpHeader",xo:"UserAgent",qo:"Cookie",jj:"CustomData"};_.u=gQ.prototype;_.u.initialize=function(){this.a.on($Q,this.xh,this);this.a.on(lR,this.wh,this);this.a.on(mR,this.vh,this);this.a.on(aR,this.Ii,this);this.a.on(cR,this.Hi,this);this.a.on(nR,this.yh,this)};_.u.release=function(){iQ(this,_.Vp);this.l=!1;this.o=-1;this.h=2};_.u.destroy=function(){this.release();this.a.off($Q,this.xh);this.a.off(lR,this.wh);this.a.off(mR,this.vh);this.a.off(aR,this.Ii);this.a.off(cR,this.Hi);this.a.off(nR,this.yh);this.m=this.a=null};
_.u.xh=function(){this.g.debug("Buffering start. Player state: ",this.a.getState());this.h=this.a.B?1:2;iQ(this,_.$p)};_.u.wh=function(a){this.g.debug("Buffering progress: "+a.percent+" %. Player state: ",hQ(this.f))};_.u.vh=function(){this.g.debug("Buffering complete. Player state: ",this.a.getState());if(!this.l){this.l=!0;var a=this.m.getConfiguration().autoplay,b=this.a.getState()===oR;if(!a&&b){iQ(this,_.hq);return}}if(a=this.f!==_.gq)a=this.a.getState(),a=a===jQ||a===kQ;a&&lQ(this)};
_.u.Ii=function(){this.g.debug("Preparing starts. AVPlay State: ",this.a.getState());this.a.getState()===pR?iQ(this,_.gq):this.g.error("AVPlay prepares while state is not IDLE")};_.u.Hi=function(){this.g.debug("Preparing ends: AVPlay state:",this.a.getState())};_.u.yh=function(){iQ(this,_.bq)};_.u.getState=function(){return this.f};_.u=mQ.prototype;_.u.initialize=function(a){this.m=a};
_.u.load=function(a){var b=this,c,d,e,f,g,h,l;return _.I(function(m){switch(m.a){case 1:if(!b.m)return b.g.debug("Text streamer is not initialized. Will not load()"),m["return"]();b.B=a;c=b;return _.y(m,oQ(b),2);case 2:c.j=m.f;if(!b.j)return b.g.debug("Could not find manifest parser for source. Make sure parsers are registered."),m["return"]();d={configurationId:"",networkingEngine:b.m.getNetworkEngine(),filterNewPeriod:function(){},filterAllPeriods:function(){},onEvent:function(){},onError:function(){}};
_.D(m,3);e=b;return _.y(m,b.j.start(a.url,d),5);case 5:e.a=m.f;_.sh(m,4);break;case 3:return f=_.F(m),b.g.warn(f),_.D(m,6),g=b,_.y(m,b.j.start(a.url.replace("https://","http://"),d),8);case 8:g.a=m.f;_.sh(m,4);break;case 6:h=_.F(m),b.g.error(h),b.a=null;case 4:if(!b.a||!nQ(b.a)){m.F(0);break}b.h=pQ(b);_.D(m,10);return _.y(m,b.h.open(),12);case 12:b.f=qQ(b);l=b.m.getConfiguration();b.f.h=l.streaming;b.o=l.preferredTextLanguage;b.A=l.preferredTextRole;b.C=l.preferForcedSubtitles;_.sh(m,0);break;case 10:_.F(m),
b.g.debug("Could not setup media source..."),b.h=null,b.f=null,b.j=null,b.a=null,_.B(m)}})};_.u.Tk=function(a){this.g.debug(_.BD,a);this.w=!0;var b=_.kH(a.textStreams,this.o||"",this.A||"",this.C)[0]||null;this.l&&(a.textStreams.includes(this.l)&&(b=this.l),this.l=null);return{variant:null,text:b}};_.u.Sk=function(){this.g.debug("canSwitch_");this.w=!1;this.l&&(_.uI(this.f,this.l,!0,0),this.l=null)};_.u.Uk=function(){this.g.debug("onError_")};_.u.Vk=function(){this.j&&this.j.update&&this.j.update()};
_.u.start=function(){var a=this;return _.I(function(b){if(!a.f)return b["return"]();try{a.f.start()}catch(c){a.g.error("Error while starting streaming engine",c)}_.B(b)})};_.u.setTextVisibility=function(a){this.g.debug("Set text visibility",a);this.h&&this.h.getTextDisplayer().setTextVisibility(a)};_.u.release=function(){var a=this;return _.I(function(b){a.m=null;a.a=null;a.B=null;a.A=null;a.o=null;a.w=!0;a.l=null;_.B(b)})};
_.u.destroy=function(){var a=this;return _.I(function(b){switch(b.a){case 1:if(!a.j){b.F(2);break}return _.y(b,a.j.stop(),3);case 3:a.j=null;case 2:if(!a.f){b.F(4);break}return _.y(b,a.f.destroy(),5);case 5:a.f=null,a.w=!0;case 4:if(!a.h){b.F(0);break}return _.y(b,a.h.destroy(),7);case 7:a.h=null,_.B(b)}})};_.x(vQ,_.kl);_.u=vQ.prototype;_.u.yi=function(a){var b=a.eventid;a=a.data;switch(b){case qR:0<Object.keys(this.f).length||(this.g.debug("Loading track manager!"),this.load());b=webapis.avplay.getCurrentStreamInfo();0<b.length&&(b=+GQ(this,b[0].extra_info).Bit_rate,b=KQ(this,{bandwidth:b}))&&(this.w=b,wQ(this,b));break;case rR:xQ(this);break;default:this.g.debug("Event type: "+b+" data: "+a)}};_.u.jg=function(a){a.detail.currentState===_.iq&&this.m.off(_.fg,this.jg)};
_.u.initialize=function(a){var b=this;this.m=a;this.a=this.m.a;this.m.on(_.fg,function(c){b.A||(c=c.detail,c.currentState===_.iq&&(b.g.debug("Current state",c.currentState),b.A=!0,yQ(b)))});this.a.on(sR,this.yi,this)};_.u.release=function(){this.f={};this.h=this.w=this.l=this.j=null;this.A=!1;this.o=1};
_.u.load=function(){if(this.a&&!(0<Object.keys(this.f).length)){this.h=this.m.h;this.m.off(_.fg,this.jg);this.m.on(_.fg,this.jg,this);try{var a=WQ(this.a);this.f=JQ(this,a);var b=this.f[_.Ik]||[];b.length&&(this.j=b[0].renditions[0]||null);xQ(this)}catch(c){this.g.debug("Could not load track manager")}}};_.u.destroy=function(){this.a.off(sR,this.yi);this.a=this.m=null};_.u.getVideoTracks=function(){return this.f[_.Jk]||[]};_.u.getAudioTracks=function(){return this.f[_.Ik]||[]};
_.u.ja=function(){return this.f[_.U]||[]};_.u.ka=function(){return NQ(this,_.Jk)};_.u.Va=function(){return NQ(this,_.Ik)};_.u.Sa=function(){return NQ(this,_.U)};_.u.rb=function(){return this.w};_.u.Db=function(){this.g.info(UP);return null};_.u.Eb=function(){this.g.info(UP);return null};_.u.Ia=function(){var a=this.ka();return a?a.track:null};_.u.oa=function(){var a=this.Va();return a?a.track:null};_.u.ya=function(){var a=this.Sa();return a?a.track:null};
_.u.zb=function(a){var b=this;null===a?(a=this.ka(),fR(this.a,a.bandwidth,null).then(function(){xQ(b)})):0<a.renditions.length&&this.jb(a.renditions[0])};_.u.Fa=function(a){a?CQ(this,a.renditions[0]):this.g.warn("Cannot disable audio tracks on this platform.","Consider muting audio instead...")};_.u.Ta=function(a){a?(a=a.renditions[0],this.h?uQ(this.h,a.track):CQ(this,a)):(this.g.debug("Disabling text tracks"),this.l=null,gR(this.a,!1),this.m.trigger(new _.L(_.qm)))};
_.u.jb=function(a){var b=this,c=this.ka();this.a.o||a.width!==c.width||a.height!==c.height||a.bandwidth!==c.bandwidth?(this.w=a,wQ(this,a),fR(this.a,c.bandwidth,a.bandwidth).then(function(){xQ(b)})["catch"](function(d){var e=new _.O(_.P,7,7200,{tizenerror:d});b.g.debug("Error while switching video track",d);b.m.onError(e)})):this.g.debug("Trying to switch to already active rendition. Doing nothing...")};_.u.xb=function(a){CQ(this,a)};_.u.yb=function(a){this.h?uQ(this.h,a.track):CQ(this,a)};
_.u.addTextTrack=function(){};_.u.ta=function(){return this.a.o};vQ.prototype.isAbrEnabled=vQ.prototype.ta;vQ.prototype.addTextTrack=vQ.prototype.addTextTrack;vQ.prototype.setTextRendition=vQ.prototype.yb;vQ.prototype.setAudioRendition=vQ.prototype.xb;vQ.prototype.setVideoRendition=vQ.prototype.jb;vQ.prototype.setTextTrack=vQ.prototype.Ta;vQ.prototype.setAudioTrack=vQ.prototype.Fa;vQ.prototype.setVideoTrack=vQ.prototype.zb;vQ.prototype.getTextTrack=vQ.prototype.ya;vQ.prototype.getAudioTrack=vQ.prototype.oa;
vQ.prototype.getVideoTrack=vQ.prototype.Ia;vQ.prototype.getLoadingTextRendition=vQ.prototype.Eb;vQ.prototype.getLoadingAudioRendition=vQ.prototype.Db;vQ.prototype.getLoadingVideoRendition=vQ.prototype.rb;vQ.prototype.getTextRendition=vQ.prototype.Sa;vQ.prototype.getAudioRendition=vQ.prototype.Va;vQ.prototype.getVideoRendition=vQ.prototype.ka;vQ.prototype.getTextTracks=vQ.prototype.ja;vQ.prototype.getAudioTracks=vQ.prototype.getAudioTracks;vQ.prototype.getVideoTracks=vQ.prototype.getVideoTracks;_.x(OQ,_.wm);_.u=OQ.prototype;_.u.Nk=function(){this.w=!0;this.f||this.trigger(new _.L($Q))};_.u.Mk=function(a){this.w=!0;this.trigger(new _.L(lR,{percent:a}))};_.u.Lk=function(){this.w=!1;this.trigger(new _.L(mR))};_.u.Qk=function(){this.trigger(new _.L(nR))};_.u.Pk=function(a,b){this.trigger(new _.L(sR,{eventid:a,data:b}))};_.u.Rk=function(a,b,c,d,e){this.trigger(new _.L(tR,{duration:a,text:b,subtitleType:c,attriCount:d,attributes:e}))};
_.u.Ok=function(a,b){this.trigger(new _.L(uR,{drmType:a,drmData:b}));if(this.h){var c=this.h;if(c.j)if(c.a===_.Od&&"Challenge"===b.name)fQ(c,b);else if("DrmError"===b.name){c.g.debug("DrmError event",b);var d=new _.O(_.P,6,6005,{message:JSON.stringify(b)});c.D.onError(d)}}};_.u.Hd=function(a){this.trigger(new _.L(vR,{eventType:a}))};
_.u.play=function(){function a(){return new Promise(function(d,e){function f(){d();clearTimeout(g)}var g=null;b.one(QQ,f,b);g=setTimeout(function(){b.off(QQ,f);e("Timeout")},3E4)})}var b=this,c=this.getState();if(c===pR)return(new Promise(function(d,e){webapis.avplay.prepareAsync(function(){SQ(b);d(webapis.avplay.play())},function(f){b.trigger(new _.L(vR));e(f)})})).then(function(){return a()});if(c===kQ||c===oR)try{return webapis.avplay.play(),a()}catch(d){return Promise.reject(d)}return c===jQ?
Promise.resolve():Promise.reject("Player is in invalid state")};_.u.pause=function(){try{webapis.avplay.pause()}catch(a){Promise.reject(a)}return this.getState()===kQ?Promise.resolve():Promise.reject()};
_.u.setPlaybackRate=function(a){var b=this.getState();if(b===oR||b===jQ||b===kQ){try{webapis.avplay.setSpeed(a),this.C=a}catch(c){return this.g.debug("Error while trying to set playback rate",c),this.setPlaybackRate(this.C)}return!0}this.g.debug("Cannot set playback rate; AVPlay is in inconsistent state: "+b);return!1};_.u.getPlaybackRate=function(){return this.C};
_.u.load=function(a,b){var c=this,d;return _.I(function(e){switch(e.a){case 1:return c.g.debug("configure()",b||""),_.D(e,2),_.y(e,ZQ(c),4);case 4:return _.y(e,eR(c,a,b),5);case 5:_.sh(e,0);break;case 2:throw d=_.F(e),new _.O(_.P,7,7003,null,d);}})};_.u.getState=function(){if(this.f&&this.a)return this.a.Zg;try{return webapis.avplay.getState()}catch(a){this.Hd(JSON.stringify(a))}};
_.u.seek=function(a){var b=this,c=1E3*a;return new Promise(function(d,e){b.B=!0;b.m.trigger(new _.L(_.Ag));webapis.avplay.seekTo(c,function(){b.B=!1;b.m.trigger(new _.L(_.zg));d()},function(){b.B=!1;e()})})};_.u.getPosition=function(){if(this.f&&this.a)return this.a.position;try{return webapis.avplay.getCurrentTime()/1E3}catch(a){this.Hd(JSON.stringify(a))}};_.u.getDuration=function(){if(this.f&&this.a)return this.a.duration;try{return webapis.avplay.getDuration()/1E3}catch(a){this.Hd(JSON.stringify(a))}};
_.u.release=function(){var a=this;return new Promise(function(b,c){try{a.h&&(a.h.release(),a.h=null);webapis.avplay.stop();webapis.avplay.close();for(var d in a.j){var e=a.j[d];e&&e.hf.stop()}a.j={};a.C=1;a.B=!1;a.l=null;a.a=null;return b()}catch(f){return c(f)}})};_.u.getVolume=function(){var a=null;try{a=tizen.tvaudiocontrol.getVolume()}catch(b){switch(b.name){case WP:this.g.debug("The application does not have the privilege to get the volume.",XP);break;default:this.g.debug(TP,b)}}return a};
_.u.setVolume=function(a){try{tizen.tvaudiocontrol.setVolume(Math.max(0,Math.min(100*a,100)))}catch(b){switch(b.name){case "InvalidValueError":this.g.warn("Invalid value passed for setVolume.","The passed value value should be in the range of 0 to 1.");break;case WP:this.g.warn("The application does not have the privilege to set the volume.",XP);break;default:this.g.warn("An unknown error occurred while trying to set volume",b)}}};
_.u.isLive=function(){if(this.f&&this.a)return this.a.isLive;try{return"1"===webapis.avplay.getStreamingProperty("IS_LIVE")}catch(a){this.Hd(JSON.stringify(a))}};_.u.stop=function(){try{webapis.avplay.stop()}catch(a){this.g.debug(a)}};_.u.getDrmInfo=function(){this.h&&this.h.getDrmInfo();return null};_.u.setSourceIndex=function(a){this.G=a};_.u.getSourceIndex=function(){return this.G};_.u.getLoadedSource=function(){return this.l&&this.l[this.getSourceIndex()]};
var pR="IDLE",oR="READY",jQ="PLAYING",kQ="PAUSED",HQ=_.gc,AQ="AUDIO",BQ="TEXT",rR="PLAYER_MSG_RESOLUTION_CHANGED",qR="PLAYER_MSG_BITRATE_CHANGE",dQ={PLAYREADY:"PLAYREADY",ro:"EME_PLAYREADY",yo:"VERIMATRIX",Ae:"WIDEVINE_CDM",so:"EME_WIDEVINE_CDM",Ao:"WIDEVINE_CLASSIC"};_.x(hR,_.wm);_.u=hR.prototype;_.u.th=function(){var a=this;this.g.debug("On Stream completed. Current time: ",this.getPosition());this.trigger(new _.L(_.pe));this.configuration.loop?this.seek(this.configuration.startTime||0)["catch"](function(){a.g.debug("Could not loop playback")}):this.a.stop()};_.u.qh=function(a){this.trigger(new _.L(_.qg,{currentTime:a.currentTime/1E3}))};
_.u.uh=function(a){var b=this.a.getPosition(),c=b+a.duration/1E3,d=a.text||"";this.g.debug("Got subtitles: ",d,"start:",b,"end:",c,a);(d=_.T.Eg(d))&&this.o.append([new _.Li(b,c,d)],[])};_.u.rh=function(a){this.g.debug("DRM event: "+a.drmType+", data: "+a.drmData)};_.u.Ai=function(){this.A||(this.g.debug("Initial buffering completed..."),this.A=!0)};
_.u.sh=function(a){this.g.debug("Error: TYPE: "+a.eventType);iQ(this.f,_.fq);a=new _.O(_.P,7,7200,{tizenerror:a.eventType});this.a.release();this.trigger(new _.L(_.qe,{detail:a}))};
_.u.init=function(a,b){this.configuration=this.B=b;this.w=a;this.a.on(nR,this.th,this);this.a.on(QQ,this.qh,this);this.a.on(tR,this.uh,this);this.a.on(uR,this.rh,this);this.a.on(vR,this.sh,this);this.a.on(mR,this.Ai,this);this.f.initialize();this.l.initialize(this);this.g.debug("Initializing player surface");this.w.hideMediaElement();var c=wR;wR+=1;this.j=_.Iq(_.Xe,{id:"__clpp_tizen_player_"+c,type:"application/avplayer"});this.w.addElementToContainer(this.j,!0);var d=this.w.getMedia();if(d){c=this.j;
var e=[_.Wg,_.ve,"position",_.Be,"top"],f={};d=null!==d.parentElement?window.getComputedStyle(d,null):d.style;if(!e||0===e.length){e||(e=[]);for(var g in d)e.push(g)}g=_.w(e);for(e=g.next();!e.done;e=g.next())e=e.value,f[e]=d[e];_.Kq(c,f);iR(this)}};_.u.getSurface=function(){return this.w};_.u.getConfiguration=function(){return this.configuration};_.u.getTimeline=function(){return null};_.u.setupPlaylist=function(){return Promise.reject(_.Bb)};_.u.appendLoad=function(){return Promise.reject(_.Bb)};
_.u.seekWith=function(){return Promise.reject(_.Bb)};_.u.setSeekInterceptor=function(){};_.u.setPlaybackSessionId=function(){};
_.u.destroy=function(){var a=this;return _.I(function(b){switch(b.a){case 1:return _.y(b,a.release(),2);case 2:a.a.off(nR,a.th);a.a.off(QQ,a.qh);a.a.off(tR,a.uh);a.a.off(uR,a.rh);a.a.off(vR,a.sh);a.a.off(mR,a.Ai);if(!a.h){b.F(3);break}return _.y(b,a.h.destroy(),4);case 4:a.h=null;case 3:a.j&&(a.j.parentElement.removeChild(a.j),a.j=null),a.l.destroy(),a.f.destroy(),a.l=null,a.f=null,_.B(b)}})};_.u.namespace=function(){return xR};_.u.getPlaybackRate=function(){return this.a.getPlaybackRate()};
_.u.setDrmCustomDataModifier=function(){};_.u.setCdnErrorCallback=function(){};_.u.detach=function(){};_.u.setPlaybackRate=function(a){this.a.setPlaybackRate(a)};_.u.getPosition=function(){return this.getMediaPosition()};_.u.getMediaPosition=function(){return 0<(this.configuration.startTime||0)&&!this.A?0:this.f.getState()===_.bq?this.getDuration():this.a.getPosition()||0};_.u.seek=function(a){return typeof a===_.k&&0<=a?(this.isLive()||(a=Math.min(a,this.getDuration())),this.a.seek(a)):Promise.reject()};
_.u.getPresentationStartTime=function(){return null};_.u.getSeekRange=function(){return{start:0,end:0}};_.u.getVolume=function(){var a=this.a.getVolume();return typeof a===_.k?a/100:null};_.u.setVolume=function(a){this.a.setVolume(a)};_.u.getDuration=function(){return this.getMediaDuration()};_.u.getMediaDuration=function(){return this.a.getDuration()};_.u.getBufferInfo=function(){this.g.warn(_.sa);return new _.vm};_.u.getTrackManager=function(){return this.l};_.u.unload=function(){var a=this;return this.a.release().then(function(){a.l.release()})};
_.u.release=function(){var a=this;return _.I(function(b){switch(b.a){case 1:if(!a.h){b.F(2);break}return _.y(b,a.h.release(),2);case 2:if(!a.o){b.F(4);break}return _.y(b,a.o.destroy(),5);case 5:a.o=null;case 4:return _.y(b,a.a.release(),6);case 6:a.l.release(),a.f.release(),a.A=!1,_.B(b)}})};
_.u.load=function(a){var b=this,c,d,e,f,g;return _.I(function(h){switch(h.a){case 1:b.configuration=_.Em(b.B,a);c=_.Jp(b.configuration,[_.xe,"native"]);b.o=c.create(b);d=_.mq(b.configuration)[0];e=!!b.configuration.tizen&&b.configuration.tizen.sideStreamText;if(!e){h.F(2);break}b.h=new mQ;b.h.initialize(b);_.D(h,3);return _.y(h,b.h.load(d),5);case 5:b.h.start();_.sh(h,2);break;case 3:f=_.F(h),b.g.error(f);case 2:return _.D(h,6),_.y(h,b.a.load(b.configuration),8);case 8:_.sh(h,7);break;case 6:throw g=
_.F(h),b.onError(g),g;case 7:b.l.load(),_.B(h)}})};_.u.play=function(){var a=this;this.trigger(new _.L(_.mf));iR(this);return this.a.play().then(function(){lQ(a.f)})};_.u.pause=function(){var a=this;return this.a.pause().then(function(){lQ(a.f)})};_.u.getState=function(){return this.f.getState()};_.u.getPeriods=function(){return[]};_.u.onError=function(a){var b=new _.L(_.qe,{detail:a});a.severity===_.P&&(iQ(this.f,_.fq),this.a.release());this.trigger(b);b.defaultPrevented&&(b.a=!0)};
_.u.getDrmInfo=function(){return this.a.getDrmInfo()};_.u.isEnded=function(){return this.f.getState()===_.bq};_.u.isPaused=function(){return this.a.getState()===kQ};_.u.isMuted=function(){return VQ(this.a)};_.u.setMuted=function(a){dR(this.a,a)};_.u.getNetworkEngine=function(){return this.C};_.u.setNetworkEngine=function(a){this.C=a};_.u.setCmsdManager=function(){};_.u.isLive=function(){return this.a.isLive()};_.u.getStats=function(){return null};_.u.setSourceIndex=function(a){this.a.setSourceIndex(a)};
_.u.getSourceIndex=function(){return this.a.getSourceIndex()};_.u.getLoadedSource=function(){return this.a.getLoadedSource()};_.u.canPlay=function(a,b){return(new jR).canPlay(a,b)};_.u.getTimelineCues=function(){return[]};_.u.getCueTimeline=function(){return null};_.u.getTextDisplayer=function(){return this.o};_.u.resetAbr=function(){};var xR="clpp.tizen",wR=0;jR.prototype.a=function(){return xR};
jR.prototype.canPlay=function(a){a=a.type;var b=!!window.webapis;if((a===_.Sc||a===_.gm||a===_.Xc)&&b){if(_.vk(2))return 2;if(_.vk(3)||_.vk(4)||_.vk(5)||_.vk(6))return _.Hh("Use of clpp.tizen.TizenComponent is not recommended for Tizen version \x3e\x3d 3."),1}return 0};jR.prototype.f=function(a){return a===_.na};jR.prototype.create=function(){return new hR};_.x(kR,_.Kt);kR.prototype.f=function(){_.Rh(new jR)};kR.prototype.a=function(){var a=xR;a&&_.Ph[a]&&(delete _.Ph[a],_.Qh.info("Removed Player factory: '"+a+"'"))};kR.prototype.id=function(){return"tizen"};_.J("clpp.tizen.TizenComponent",kR);var $Q="onbufferingstart",lR="onbufferingprogress",mR="onbufferingcomplete",nR="onstreamcompleted",QQ="oncurrentplaytime",sR="onevent",tR="onsubtitlechange",uR="ondrmevent",vR="onerror",aR="preparingstart",cR="preparingend";};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();