(function(){var g={}; var _ = _ || {}
var f=function(window){var QU="Ad Error",RU="onAdBreakStarted()",SU="onAdBreakStopped()",TU=function(a){function b(l,m){l in h||!m||(h[l]=m)}var c=_.qk(),d=Conviva.Constants.DeviceType.DESKTOP,e=Conviva.Constants.DeviceCategory.WEB,f=c.os;c=c.osVersion.name;var g="";_.wl()&&(g="Apple");_.vl()?(g="Google",d=Conviva.Constants.DeviceType.SETTOP,e=Conviva.Constants.DeviceCategory.CHROMECAST):_.xl()?(d=Conviva.Constants.DeviceType.MOBILE,/(android)/i.test(navigator.userAgent)?e=Conviva.Constants.DeviceCategory.ANDROID_DEVICE:
_.wl()&&(e=Conviva.Constants.DeviceCategory.APPLE_DEVICE)):_.pk()||_.ok()||_.sl("Hisense")?(d=Conviva.Constants.DeviceType.SMARTTV,e=Conviva.Constants.DeviceCategory.SMART_TV,_.pk()?(c="",g="LG",e=Conviva.Constants.DeviceCategory.LG_TV):_.ok()?(g="Samsung",e=Conviva.Constants.DeviceCategory.SAMSUNG_TV):_.sl("Hisense")&&(c="",g="Hisense")):_.sl("Xbox One")&&(g="Microsoft",d=Conviva.Constants.DeviceType.CONSOLE,e=Conviva.Constants.DeviceCategory.XBOX);var h=a.deviceMetadata||{};b(Conviva.Constants.DeviceMetadata.TYPE,
a.deviceType||d);b(Conviva.Constants.DeviceMetadata.OS_NAME,f);b(Conviva.Constants.DeviceMetadata.OS_VERSION,c);b(Conviva.Constants.DeviceMetadata.CATEGORY,a.deviceCategory||e);b(Conviva.Constants.DeviceMetadata.BRAND,a.deviceBrand||g);return h},UU=function(a){return a?Conviva.Constants.StreamType.LIVE:Conviva.Constants.StreamType.VOD},VU=function(a){return 0===a?"Pre-roll":-1===a?"Post-roll":"Mid-roll"},XU=function(a,b,c,d){var e={};e[Conviva.Constants.PLAYER_NAME]=c;e[Conviva.Constants.VIEWER_ID]=
b;e[Conviva.Constants.IS_LIVE]=UU(!!d);e[Conviva.Constants.ASSET_NAME]=QU;a&&(e[Conviva.Constants.ASSET_NAME]=a.getTitle(),e[Conviva.Constants.STREAM_URL]=a.getMediaUrl(),e[Conviva.Constants.DURATION]=a.getDuration(),e["c3.ad.id"]=WU(a.getId()),e["c3.ad.creativeId"]=WU(a.getCreativeId()),e["c3.ad.system"]=WU(a.getAdSystem()),e["c3.ad.mediaFileApiFramework"]=WU(a.getApiFramework()),e["c3.ad.advertiser"]=WU(a.getAdvertiserName()),e["c3.ad.position"]=VU(a.getPodIndex()),e["c3.ad.technology"]=0===a.rb()?
Conviva.Constants.AdType.CLIENT_SIDE:Conviva.Constants.AdType.SERVER_SIDE,e["c3.ad.adManagerName"]=WU(a.nb()),e["c3.ad.adManagerVersion"]=WU(a.ob()),e["c3.ad.advertiserCategory"]=WU(null),e["c3.ad.advertiserId"]=WU(null),e["c3.ad.breakId"]=WU(null),e["c3.ad.campaignName"]=WU(null),e["c3.ad.category"]=WU(null),e["c3.ad.classification"]=WU(null),e["c3.ad.creativeName"]=WU(null),e["c3.ad.sequence"]=WU(a.Db()),e["c3.ad.sessionStartEvent"]=WU(null),e["c3.ad.unitName"]=WU(null),e["c3.ad.dayPart"]=WU(null),
b=a.getWrapperAdIds().slice(-1)[0]||a.getId(),c=a.getWrapperAdSystems().slice(-1)[0]||a.getAdSystem(),a=a.getWrapperCreativeIds().slice(-1)[0]||a.getCreativeId(),e["c3.ad.firstAdId"]=WU(b),e["c3.ad.firstAdSystem"]=WU(c),e["c3.ad.firstCreativeId"]=WU(a));return e},WU=function(a){return a?""+a:"NA"},YU=function(a,b){this.m=a;this.B=b;this.A="";this.w=_.va;this.g=new _.K("clpp.conviva.ad");this.f=new _.Sh;this.a=null;this.j=this.l=this.o=this.h=!1},ZU=function(a,b){if(!a.l){a.j=!1;try{if(a.a=Conviva.Analytics.buildAdAnalytics(a.B()),
b){var c=XU(b,a.A,a.w,a.m.isLive()),d=String(b.ob()),e={};e[Conviva.Constants.FRAMEWORK_NAME]=b.nb();e[Conviva.Constants.FRAMEWORK_VERSION]=d;a.a.setAdPlayerInfo(e);a.a.reportAdStarted(c)}}catch(f){a.g.error("Could not create ad analytics session",f)}}},bV=function(a,b,c){c=void 0===c?QU:c;if(a.a){a.a.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.STOPPED);switch(b){case $U:a.a.reportAdFailed(c,XU(null,a.A,a.w));break;case aV:a.a.reportAdSkipped();break;default:a.a.reportAdEnded()}a.a.release();
a.a=null;a.h=!1}},cV=function(a){a.f.on(a.m,_.uc,a.Ej.bind(a));a.f.on(a.m,_.vc,a.Fj.bind(a));a.f.on(a.m,_.Jc,a.Lj.bind(a));a.f.on(a.m,_.Gc,a.Oe.bind(a));a.f.on(a.m,_.Fc,a.Oe.bind(a));a.f.on(a.m,_.Hc,a.Oe.bind(a));a.f.on(a.m,_.wc,a.Oe.bind(a));a.f.on(a.m,_.Kc,a.Mj.bind(a));a.f.on(a.m,_.Ic,a.Kj.bind(a));a.f.on(a.m,_.xc,a.Gj.bind(a));a.f.on(a.m,_.Cc,a.Ij.bind(a));a.f.on(a.m,_.Dc,a.Jj.bind(a));a.f.on(a.m,_.zc,a.Hj.bind(a));a.f.on(a.m,_.Ec,a.am.bind(a));a.f.on(a.m,_.Lc,a.Nj.bind(a));a.f.on(a.m,_.ne,function(b){var c=
b.detail;if(10003===c.code&&(a.g.debug("onAdError()"),!a.j)){b=Conviva.Constants.ErrorSeverity;switch(c.data.errorType){case 0:c="Ad Load Error";break;case 1:c="Ad Play Error";break;default:c=QU}null===a.a&&ZU(a,null);a.a.reportAdError(c,b.FATAL);a.j=!0;a.g.debug("Ad Playback Failure");bV(a,$U,c)}})},dV=function(a,b){this.m=a;this.f=new _.Sh;this.a=null;this.o=!1;this.H=!0;this.B=this.h=this.A=this.C=this.l=!1;this.N=0;this.K=!1;this.w=null;this.J=!1;this.g=b;this.L=this.G=null;this.j=[];this.I=0},
eV=function(a){if(!a.l&&a.a){var b=UU(a.m.isLive()),c={};c[Conviva.Constants.IS_LIVE]=b;c[Conviva.Constants.DURATION]=a.m.getDuration();a.a.setContentInfo(c)}},fV=function(a){return null!==a.a&&a.C},gV=function(a){return a.m.getConfiguration().autoplay||!1},hV=function(a,b){var c={};c[Conviva.Constants.LOG_LEVEL]=Conviva.Constants.LogLevel.DEBUG;b.serviceUrl&&(a.g.warn("Touchstone URL is set. Do not set this in production!"),c[Conviva.Constants.GATEWAY_URL]=b.serviceUrl.replace(/\/$/,""));Conviva.Analytics.init(b.customerKey,
null,c);Conviva.Analytics.setDeviceMetadata(TU(b));b.connectionType&&Conviva.Analytics.reportDeviceMetric(Conviva.Constants.Network.CONNECTION_TYPE,b.connectionType);a.a=Conviva.Analytics.buildVideoAnalytics();a.o=!1;c={};c[Conviva.Constants.FRAMEWORK_NAME]=_.va;c[Conviva.Constants.FRAMEWORK_VERSION]=_.ja;a.a.setPlayerInfo(c)},iV=function(a){if(!a.l)if(a.C)a.g.warn("Current session still active. No-op.");else{var b=a.m.getLoadedSource()||a.L,c=a.m.getConfiguration().conviva||null,d=c&&c.viewerId||
"N/A",e=c&&c.defaultResource||"N/A";a.g.debug(a.m.getConfiguration().source);var f={},g=new _.Jk(b.url);b&&(f[Conviva.Constants.ASSET_NAME]=b.name||"N/A",f[Conviva.Constants.STREAM_URL]=_.Kk(g));f[Conviva.Constants.PLAYER_NAME]=c.playerName||_.va;f[Conviva.Constants.VIEWER_ID]=d;f[Conviva.Constants.DEFAULT_RESOURCE]=e;if(c&&!_.M.R(c.customTags))for(var h in c.customTags)f[h]=c.customTags[h];a.a.reportPlaybackRequested(f);a.a.setCallback(function(){a.g.debug("reportMiscellaneousMetrics()");if(fV(a)){var l=
1E3*a.m.getPosition();a.a.reportPlaybackMetric(Conviva.Constants.Playback.PLAY_HEAD_TIME,l);if(l=a.m.getStats()){l=l.decodedFrames;var m=l-a.I;a.I=l;isFinite(m)&&(a.g.debug("Current FPS",m),a.a.reportPlaybackMetric(Conviva.Constants.Playback.RENDERED_FRAMERATE,m))}}});a.C=!0;a.h=!0;a.J=!1;0<a.j.length&&(a.g.debug("Report deferred events"),a.j.forEach(function(l){l.Bh(l.args)}));a.j=[]}},jV=function(a){a.g.debug("terminateSession()");a.a&&(a.a.reportPlaybackMetric(Conviva.Constants.Playback.PLAYER_STATE,
Conviva.Constants.PlayerState.STOPPED),a.a.reportPlaybackEnded(),a.a.release(),Conviva.Analytics.release(),a.o=!0,a.C=!1,a.A=!1,a.h=!1,a.w=null,a.B=!1,a.N=0,a.K=!1,a.j=[],a.I=0)},kV=function(){this.h=this.f=null;this.a=!1;this.g=new _.K("clpp.conviva")},lV=function(a){var b=[];typeof a===_.Ue&&(a.customerKey||b.push("customerKey"),a.viewerId||b.push("viewerId"));if(0<b.length)throw new _.N(1,9,9001,{missingKeys:b});},mV=function(a,b){var c=b.getConfiguration();a.a=!_.M.R(c.conviva)&&typeof c.conviva===
_.Ue;a.a?"undefined"===typeof window.Conviva?(a.g.warn("Conviva SDK is not loaded. Will do nothing."),a.a=!1,c=new _.N(1,9,9E3),a.S(b,c)):b.namespace()===_.Ad&&(a.a=!1,a.g.debug("Conviva does not report when casting.")):a.g.debug("Conviva plugin is loaded but not configured. Will do nothing.")},nV=function(){};_.u=YU.prototype;_.u.initialize=function(a){this.g.debug("Initialize Ad Insights");this.j=this.o=!1;this.A=a.viewerId;this.w=a.playerName||_.va;cV(this)};_.u.release=function(){this.g.debug("Release Ad Insights");this.o?this.g.debug(_.ma):(_.Vh(this.f),this.a&&bV(this,oV),this.f.release(),this.o=!0,this.h=this.j=!1)};_.u.destroy=function(){this.g.debug(_.Ud);this.l?this.g.debug(_.la):this.l=!0};_.u.Ej=function(){this.g.debug(RU)};_.u.Fj=function(){this.g.debug(SU)};
_.u.Lj=function(a){this.g.debug("onAdStarted()");a=a.ad;this.h||(this.g.warn("Ad load event was not triggered. This will have incidence on VSF"),ZU(this,a));this.h=!1;this.a.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.PLAYING);this.a.reportAdMetric(Conviva.Constants.Playback.RESOLUTION,a.eb(),a.cb());this.a.reportAdMetric(Conviva.Constants.Playback.BITRATE,a.Pa())};
_.u.Oe=function(a){var b=this;this.g.debug("onAdStateChanged()");if(this.a){var c=function(d){b.a.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,d)};switch(a.type){case _.Gc:case _.Hc:c(Conviva.Constants.PlayerState.PLAYING);break;case _.Fc:c(Conviva.Constants.PlayerState.PAUSED);break;case _.wc:c(Conviva.Constants.PlayerState.BUFFERING)}}};_.u.Mj=function(){this.g.debug("onAdStopped()");this.a&&!this.j&&bV(this,oV)};_.u.Kj=function(){this.g.debug("onAdSkipped()");this.a&&bV(this,aV)};
_.u.Gj=function(){this.g.debug("onAdClicked()");this.a&&this.a.reportAdPlayerEvent("AdClicked")};_.u.Ij=function(){this.g.debug("onAdImpression()");if(this.a){var a=Conviva.Constants.Events;this.a.reportAdPlayerEvent(a.AD_IMPRESSION_START);this.a.reportAdPlayerEvent(a.AD_IMPRESSION_END)}};
_.u.Jj=function(a){var b=this;this.g.debug("onAdLoaded()");var c=a.ad;if(-1!==c.getPodIndex()||this.m.getPosition()>=this.m.getDuration()-5)b.h=!0,ZU(b,c);else this.f.on(this.m,_.ng,function(){b.m.getPosition()>=b.m.getDuration()-5&&(b.f.off(b.m,_.ng),b.h=!0,ZU(b,c))})};_.u.Hj=function(){this.g.debug("onAdFirstQuartile()");this.a&&this.a.reportAdPlayerEvent(Conviva.Constants.Events.AD_FIRST_QUARTILE)};_.u.am=function(){this.g.debug("onAdMidPoint()");this.a&&this.a.reportAdPlayerEvent(Conviva.Constants.Events.AD_MID_QUARTILE)};
_.u.Nj=function(){this.g.debug("onAdThirdQuartile()");this.a&&this.a.reportAdPlayerEvent(Conviva.Constants.Events.AD_THIRD_QUARTILE)};var aV=0,oV=1,$U=2;_.u=dV.prototype;
_.u.initialize=function(a,b,c){this.l||(this.g.debug("Initialize conviva"),this.H=!1,this.G=_.M.bb(b),this.L=c,this.m=a,hV(this,this.G),this.f.on(this.m,_.hf,this.Cm.bind(this)),this.f.on(this.m,_.cg,this.Sj.bind(this)),this.f.on(this.m,_.hd,this.Vg.bind(this)),this.f.on(this.m,_.xg,this.Rj.bind(this)),this.f.on(this.m,_.wg,this.Qj.bind(this)),this.f.on(this.m,_.uc,this.Oj.bind(this)),this.f.on(this.m,_.vc,this.Pj.bind(this)),this.f.on(this.m,_.Nc,this.gm.bind(this)),this.f.on(this.m,_.gd,this.hm.bind(this)),
this.f.on(this.m,_.ne,this.Wg.bind(this)),gV(this)&&(this.g.debug("Start a new session: A new video starts in autoplay."),iV(this)))};_.u.release=function(){this.g.debug("Release conviva");this.H?this.g.debug(_.ma):(_.Vh(this.f),fV(this)||this.o||!gV(this)||this.a&&this.a.reportPlaybackFailed("Exit Before Video Start"),fV(this)&&jV(this),this.a=null,this.H=!0)};_.u.destroy=function(){this.g.debug(_.Ud);this.l?this.g.debug(_.la):this.l=!0};
_.u.reportAppEvent=function(a,b){var c=!1;try{Conviva.Analytics.reportAppEvent(a,b),c=!0}catch(d){this.g.debug("Report app event error",d),c=!1}return c};_.u.Cm=function(){this.g.debug("onPlayRequest()");fV(this)||gV(this)?fV(this)&&this.A&&!this.h&&(this.g.debug("Resuming VST monitoring ..."),fV(this)&&!this.h&&(this.a.reportPlaybackEvent(Conviva.Constants.Events.USER_WAIT_ENDED),this.h=!0),this.A=!1):(this.g.debug("Creating conviva session. On Play Requested / No autoplay"),iV(this))};
_.u.Sj=function(a){function b(d){if(c.o&&(c.g.debug("Creating conviva session (On Seek / Replay)"),hV(c,c.G),iV(c),eV(c),fV(c))){var e=c.m.getTrackManager();e=e.ja()||e.qb();e.width&&e.height&&c.a.reportPlaybackMetric(Conviva.Constants.Playback.RESOLUTION,e.width,e.height);e.bandwidth&&c.a.reportPlaybackMetric(Conviva.Constants.Playback.BITRATE,e.bandwidth/1E3)}fV(c)&&c.a.reportPlaybackMetric(Conviva.Constants.Playback.PLAYER_STATE,d)}var c=this;this.g.debug(_.Ze);switch(a.detail.currentState){case _.Up:b(Conviva.Constants.PlayerState.PLAYING);
break;case _.Tp:b(Conviva.Constants.PlayerState.PAUSED);break;case _.Lp:b(Conviva.Constants.PlayerState.BUFFERING);break;case _.Np:this.g.debug("onVideoEnded()"),fV(this)&&(this.w&&this.w.Eb()?(this.g.debug("Waiting for postroll Ad before terminating session"),this.K=!0):jV(this))}};
_.u.Vg=function(a){this.g.debug(_.Ve);if(fV(this)){if(a=a.detail,typeof a.width===_.k&&typeof a.height===_.k&&this.a.reportPlaybackMetric(Conviva.Constants.Playback.RESOLUTION,a.width,a.height),a.bandwidth&&this.a.reportPlaybackMetric(Conviva.Constants.Playback.BITRATE,a.bandwidth/1E3),(a=a.rendition)&&a.track&&(a=a.track)&&a.frameRate){var b={};b[Conviva.Constants.ENCODED_FRAMERATE]=a.frameRate;this.a.setContentInfo(b)}}else this.j.push({Bh:this.Vg.bind(this),args:a})};
_.u.Rj=function(){this.g.debug("onSeeking()");fV(this)&&this.a.reportPlaybackMetric(Conviva.Constants.Playback.SEEK_STARTED)};_.u.Qj=function(){this.g.debug("onSeeked()");fV(this)&&this.a.reportPlaybackMetric(Conviva.Constants.Playback.SEEK_ENDED)};_.u.gm=function(a){this.g.debug("onAdsTimelineChanged()");if(a=a.adsTimeline)this.w=a};
_.u.Oj=function(a){this.g.debug(RU);var b=a.ad;a=0===b.Qa();var c=VU(b.getPodIndex());fV(this)||gV(this)||!a||iV(this);if(fV(this)){a=0===b.rb()?Conviva.Constants.AdType.CLIENT_SIDE:Conviva.Constants.AdType.SERVER_SIDE;var d=0,e={};1===b.fb()&&(d=b.getDuration());e[Conviva.Constants.POD_DURATION]=d;e[Conviva.Constants.POD_INDEX]=++this.N;e[Conviva.Constants.POD_POSITION]=c;b=Conviva.Constants.AdPlayer;b=a!==Conviva.Constants.AdType.CLIENT_SIDE||_.vl()?b.CONTENT:b.SEPARATE;this.a.reportAdBreakStarted(a,
b,e);this.B=!0}else this.g.debug("Bug: should already have a valid session")};_.u.Pj=function(){this.g.debug(SU);fV(this)&&this.B&&(this.a.reportAdBreakEnded(),this.B=!1,this.K&&jV(this))};
_.u.Wg=function(a){this.g.debug(_.We);if(this.o&&this.J)this.g.debug("Session ended in VPF; ignoring subsequent errors");else{var b=a.detail||null,c=b&&b.message||"Player error",d=Conviva.Constants.ErrorSeverity.WARNING;b&&b.severity&&b.severity===_.P&&(d=Conviva.Constants.ErrorSeverity.FATAL,fV(this)||iV(this));fV(this)?(this.g.debug("Report error",c,d),this.a.reportPlaybackError(c,d),d===Conviva.Constants.ErrorSeverity.FATAL&&(this.g.debug("Video Playback Failure"),this.J=!0,jV(this))):this.j.push({Bh:this.Wg.bind(this),
args:a})}};_.u.hm=function(){this.g.debug("onAutoPlayBlocked()");fV(this)&&(this.g.debug("Auto-play blocked. Pausing VST monitoring."),this.A=!0,fV(this)&&this.h&&(this.a.reportPlaybackEvent(Conviva.Constants.Events.USER_WAIT_STARTED),this.h=!1))};_.u=kV.prototype;_.u.onPlayerCreated=function(a){this.f=new dV(a,this.g)};_.u.onContentWillLoad=function(a,b){var c=this;mV(this,a);if(this.a){var d=a.getConfiguration();d=_.M.bb(d.conviva||{});try{lV(d);var e=d.enableAdInsights||!1;this.f.initialize(a,d,b);e&&(this.h=new YU(a,function(){return c.f.a}),this.h.initialize(d))}catch(f){f instanceof _.N?this.S(a,f):this.S(a,new _.N(1,9,9002,f,f))}}};_.u.onContentLoaded=function(a,b){for(var c=1;c<arguments.length;++c);this.a&&eV(this.f)};
_.u.onPlayerWillDestroy=function(){this.a&&(this.a=!1,this.f.destroy(),this.f=null,this.h&&(this.h.destroy(),this.h=null))};_.u.onPlayerWillRelease=function(){this.a&&(this.f.release(),this.h&&this.h.release())};_.u.id=function(){return"conviva"};_.u.S=function(a,b){a.trigger(new _.L(_.ne,{detail:b}))};_.u.reportAppEvent=function(a,b){return this.f?this.f.reportAppEvent(a,b):!1};_.J("clpp.conviva.ConvivaPlugin",kV);kV.prototype.reportAppEvent=kV.prototype.reportAppEvent;kV.Id="conviva";
nV.prototype.create=function(){return new kV};_.Qs(new nV);};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();