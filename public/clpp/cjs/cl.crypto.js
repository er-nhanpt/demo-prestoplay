(function(){var g={}; var _ = _ || {}
var f=function(window){var DV=function(){this.B=[0,1,2,4,8,16,32,64,128,27,54];this.C=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.l=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.A=new Uint32Array(256);this.o=new Uint32Array(256);this.w=new Uint32Array(0);this.h=this.a=this.j=this.f=null;var a=this.A,b=this.o,c=this.C,d=c[0],e=c[1],f=c[2];c=c[3];var g=this.l,h=g[0],l=g[1],m=g[2];g=g[3];var n=new Uint32Array(256),p=0,q=0,t;for(t=0;256>
t;t++)n[t]=128>t?t<<1:t<<1^283;for(t=0;256>t;t++){var v=q^q<<1^q<<2^q<<3^q<<4;v=v>>>8^v&255^99;a[p]=v;b[v]=p;var z=n[p],A=n[z],G=n[A],E=257*n[v]^16843008*v;d[p]=E<<24|E>>>8;e[p]=E<<16|E>>>16;f[p]=E<<8|E>>>24;c[p]=E;E=16843009*G^65537*A^257*z^16843008*p;h[v]=E<<24|E>>>8;l[v]=E<<16|E>>>16;m[v]=E<<8|E>>>24;g[v]=E;p?(p=z^n[n[n[G^z]]],q^=n[n[q]]):p=q=1}},EV=function(a){a=_.Mj(a);for(var b=new Uint32Array(4),c=0;4>c;c++)b[c]=a.getUint32(4*c);return b},FV=function(){this.a=null},GV=function(){this.j={};
this.l=!1;this.g=new _.K("clpp.crypto")},IV=function(a,b){return function(c){var d,e,f;return _.I(function(g){if(1==g.a){d=c.request||null;if(!(d&&2===d.type&&d.keyInfo&&c.data))return g.F(2);e=d.uris[0];a.g.debug("Decrypting AES-128-encrypted video segment",e);f=c;return _.y(g,HV(a,b,c.data,d.keyInfo,e),3)}2!=g.a&&(f.data=g.f);return g["return"](c)})}},JV=function(a,b,c){var d,e,f,g,h,l;return _.I(function(m){if(1==m.a){d=_.ek(c);if(e=(new _.Xi(c)).nb.endsWith(".drmtoday.com"))f=b.getConfiguration(),
_.Rn(d,f);g=c+JSON.stringify(d.headers);if(a.j[g])return m["return"](a.j[g]);_.D(m,2);return _.y(m,b.getNetworkEngine().fetch(d).T,4)}if(2!=m.a)return h=m.f,a.j[g]=h.data,m["return"](h.data);l=_.F(m);e&&1001===l.code&&412===l.data.status&&a.g.warn("Wrong DRMtoday credentials, server responded with 412.");throw l;})},HV=function(a,b,c,d,e){var f,g,h,l,m;return _.I(function(n){switch(n.a){case 1:return f=new ArrayBuffer(0),_.D(n,2),_.y(n,JV(a,b,d.url),4);case 4:f=n.f;_.sh(n,3);break;case 2:return g=
_.F(n),a.g.warn("Could not fetch AES key",g),b.onError(new _.O(1,7,7104,null,g)),n["return"](c);case 3:return _.D(n,5),h=a.l?new FV:new DV,_.y(n,h.importKey(f),7);case 7:return _.y(n,h.decrypt(c,d.iv),8);case 8:return l=n.f,n["return"](l);case 5:return m=_.F(n),a.g.warn("Could not decrypt segment data!",e,m),b.onError(new _.O(1,3,3103,null,m)),n["return"](c)}})};
DV.prototype.importKey=function(a){a=EV(a);for(var b=!0,c=0;c<a.length&&b;)b=a[c]===this.w[c],c++;if(b)return new Promise(function(n){return n()});this.w=a;this.a=a.length;if(4!==this.a&&6!==this.a&&8!==this.a)throw Error("Invalid aes key size\x3d"+this.a);this.h=4*(this.a+7);this.f=new Uint32Array(this.h);this.j=new Uint32Array(this.h);b=this.A;var d=this.B;var e=this.l;c=e[0];var f=e[1],g=e[2],h=e[3],l=0,m=0;for(e=0;e<this.h;e++)e<this.a?l=this.f[e]=a[e]:(m=l,0===e%this.a?(m=m<<8|m>>>24,m=b[m>>>
24]<<24|b[m>>>16&255]<<16|b[m>>>8&255]<<8|b[m&255],m^=d[e/this.a|0]<<24):6<this.a&&4===e%this.a&&(m=b[m>>>24]<<24|b[m>>>16&255]<<16|b[m>>>8&255]<<8|b[m&255]),l=(this.f[e-this.a]^m)>>>0,this.f[e]=l);for(a=0;a<this.h;a++)e=this.h-a,m=a&3?this.f[e]:this.f[e-4],this.j[a]=4>a||4>=e?m:c[b[m>>>24]]^f[b[m>>>16&255]]^g[b[m>>>8&255]]^h[b[m&255]],this.j[a]>>>=0;return new Promise(function(n){return n()})};
DV.prototype.decrypt=function(a,b){var c=0,d=this.a+6,e=this.j,f=this.o,g=this.l,h=g[0],l=g[1],m=g[2];g=g[3];var n=EV(b),p=n[0],q=n[1],t=n[2];n=n[3];for(var v=_.Lj(a),z=new Int32Array(v.length),A,G,E,C,H,M,R,V,S,Ba,Ca,jb,Wa,Ma=this.G.bind(this);c<v.length;){V=Ma(v[c]);S=Ma(v[c+1]);Ba=Ma(v[c+2]);Ca=Ma(v[c+3]);H=V^e[0];M=Ca^e[1];R=Ba^e[2];C=S^e[3];jb=4;for(Wa=1;Wa<d;Wa++)A=h[H>>>24]^l[M>>16&255]^m[R>>8&255]^g[C&255]^e[jb],G=h[M>>>24]^l[R>>16&255]^m[C>>8&255]^g[H&255]^e[jb+1],E=h[R>>>24]^l[C>>16&255]^
m[H>>8&255]^g[M&255]^e[jb+2],C=h[C>>>24]^l[H>>16&255]^m[M>>8&255]^g[R&255]^e[jb+3],H=A,M=G,R=E,jb+=4;A=f[H>>>24]<<24^f[M>>16&255]<<16^f[R>>8&255]<<8^f[C&255]^e[jb];G=f[M>>>24]<<24^f[R>>16&255]<<16^f[C>>8&255]<<8^f[H&255]^e[jb+1];E=f[R>>>24]<<24^f[C>>16&255]<<16^f[H>>8&255]<<8^f[M&255]^e[jb+2];C=f[C>>>24]<<24^f[H>>16&255]<<16^f[M>>8&255]<<8^f[R&255]^e[jb+3];jb+=3;z[c]=Ma(A^p);z[c+1]=Ma(C^q);z[c+2]=Ma(E^t);z[c+3]=Ma(G^n);p=V;q=S;t=Ba;n=Ca;c+=4}return new Promise(function(wb){var Jb=z.buffer;var Cg=
Jb.byteLength,ok=Cg&&(new DataView(Jb)).getUint8(Cg-1);Jb=ok?Jb.slice(0,Cg-ok):Jb;wb(Jb)})};DV.prototype.destroy=function(){this.B=this.j=this.f=this.l=this.C=this.o=this.A=this.h=this.a=this.w=null;return new Promise(function(a){return a()})};DV.prototype.G=function(a){return a<<24|(a&65280)<<8|(a&16711680)>>8|a>>>24};FV.prototype.importKey=function(a){var b=this,c;return _.I(function(d){if(1==d.a)return c=b,_.y(d,crypto.subtle.importKey("raw",a,{name:"AES-CBC"},!1,["decrypt"]),2);c.a=d.f;_.B(d)})};FV.prototype.decrypt=function(a,b){var c=this,d;return _.I(function(e){if(1==e.a)return _.y(e,crypto.subtle.decrypt({name:"AES-CBC",iv:b},c.a,a),2);d=e.f;return e["return"](d)})};FV.prototype.destroy=function(){this.a=null;return new Promise(function(a){return a()})};_.x(GV,_.Kt);GV.prototype.f=function(){if(window.crypto&&crypto.subtle){var a=crypto.subtle.decrypt;a=typeof crypto.subtle.importKey===_.ue&&typeof a===_.ue}else a=!1;(this.l=a)||this.g.warn("No WebCrypto APIs found. Will fallback to software AES")};GV.prototype.o=function(a){var b=IV(this,a);a.getNetworkEngine().Rc(b)};GV.prototype.a=function(){this.j={}};GV.prototype.id=function(){return"crypto"};_.J("clpp.crypto.CryptoComponent",GV);};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();