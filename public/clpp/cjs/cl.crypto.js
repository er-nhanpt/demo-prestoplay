(function(){var g={}; var _ = _ || {}
var f=function(window){var JU=function(){this.B=[0,1,2,4,8,16,32,64,128,27,54];this.C=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.l=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.A=new Uint32Array(256);this.o=new Uint32Array(256);this.w=new Uint32Array(0);this.h=this.a=this.j=this.f=null;var a=this.A,b=this.o,c=this.C,d=c[0],e=c[1],f=c[2];c=c[3];var g=this.l,h=g[0],l=g[1],m=g[2];g=g[3];var n=new Uint32Array(256),p=0,q=0,t;for(t=0;256>
t;t++)n[t]=128>t?t<<1:t<<1^283;for(t=0;256>t;t++){var v=q^q<<1^q<<2^q<<3^q<<4;v=v>>>8^v&255^99;a[p]=v;b[v]=p;var z=n[p],C=n[z],F=n[C],G=257*n[v]^16843008*v;d[p]=G<<24|G>>>8;e[p]=G<<16|G>>>16;f[p]=G<<8|G>>>24;c[p]=G;G=16843009*F^65537*C^257*z^16843008*p;h[v]=G<<24|G>>>8;l[v]=G<<16|G>>>16;m[v]=G<<8|G>>>24;g[v]=G;p?(p=z^n[n[n[F^z]]],q^=n[n[q]]):p=q=1}},KU=function(a){a=_.Gj(a);for(var b=new Uint32Array(4),c=0;4>c;c++)b[c]=a.getUint32(4*c);return b},LU=function(){this.a=null},MU=function(){this.j={};
this.l=!1;this.g=new _.K("clpp.crypto")},OU=function(a,b){return function(c){var d,e,f;return _.I(function(g){if(1==g.a){d=c.request||null;if(!(d&&2===d.type&&d.keyInfo&&c.data))return g.F(2);e=d.uris[0];a.g.debug("Decrypting AES-128-encrypted video segment",e);f=c;return _.y(g,NU(a,b,c.data,d.keyInfo,e),3)}2!=g.a&&(f.data=g.f);return g["return"](c)})}},PU=function(a,b,c){var d,e,f,g,h,l;return _.I(function(m){if(1==m.a){d=_.Yj(c);if(e=(new _.Ti(c)).Ua.endsWith(".drmtoday.com"))f=b.getConfiguration(),
_.Hn(d,f);g=c+JSON.stringify(d.headers);if(a.j[g])return m["return"](a.j[g]);_.D(m,2);return _.y(m,b.getNetworkEngine().fetch(d).U,4)}if(2!=m.a)return h=m.f,a.j[g]=h.data,m["return"](h.data);l=_.E(m);e&&1001===l.code&&412===l.data.status&&a.g.warn("Wrong DRMtoday credentials, server responded with 412.");throw l;})},NU=function(a,b,c,d,e){var f,g,h,l,m;return _.I(function(n){switch(n.a){case 1:return f=new ArrayBuffer(0),_.D(n,2),_.y(n,PU(a,b,d.url),4);case 4:f=n.f;_.oh(n,3);break;case 2:return g=
_.E(n),a.g.warn("Could not fetch AES key",g),b.onError(new _.N(1,7,7104,null,g)),n["return"](c);case 3:return _.D(n,5),h=a.l?new LU:new JU,_.y(n,h.importKey(f),7);case 7:return _.y(n,h.decrypt(c,d.iv),8);case 8:return l=n.f,n["return"](l);case 5:return m=_.E(n),a.g.warn("Could not decrypt segment data!",e,m),b.onError(new _.N(1,3,3103,null,m)),n["return"](c)}})};
JU.prototype.importKey=function(a){a=KU(a);for(var b=!0,c=0;c<a.length&&b;)b=a[c]===this.w[c],c++;if(b)return new Promise(function(n){return n()});this.w=a;this.a=a.length;if(4!==this.a&&6!==this.a&&8!==this.a)throw Error("Invalid aes key size\x3d"+this.a);this.h=4*(this.a+7);this.f=new Uint32Array(this.h);this.j=new Uint32Array(this.h);b=this.A;var d=this.B;var e=this.l;c=e[0];var f=e[1],g=e[2],h=e[3],l=0,m=0;for(e=0;e<this.h;e++)e<this.a?l=this.f[e]=a[e]:(m=l,0===e%this.a?(m=m<<8|m>>>24,m=b[m>>>
24]<<24|b[m>>>16&255]<<16|b[m>>>8&255]<<8|b[m&255],m^=d[e/this.a|0]<<24):6<this.a&&4===e%this.a&&(m=b[m>>>24]<<24|b[m>>>16&255]<<16|b[m>>>8&255]<<8|b[m&255]),l=(this.f[e-this.a]^m)>>>0,this.f[e]=l);for(a=0;a<this.h;a++)e=this.h-a,m=a&3?this.f[e]:this.f[e-4],this.j[a]=4>a||4>=e?m:c[b[m>>>24]]^f[b[m>>>16&255]]^g[b[m>>>8&255]]^h[b[m&255]],this.j[a]>>>=0;return new Promise(function(n){return n()})};
JU.prototype.decrypt=function(a,b){var c=0,d=this.a+6,e=this.j,f=this.o,g=this.l,h=g[0],l=g[1],m=g[2];g=g[3];var n=KU(b),p=n[0],q=n[1],t=n[2];n=n[3];for(var v=_.Fj(a),z=new Int32Array(v.length),C,F,G,B,H,O,T,da,aa,ya,Va,fb,Wa,La=this.G.bind(this);c<v.length;){da=La(v[c]);aa=La(v[c+1]);ya=La(v[c+2]);Va=La(v[c+3]);H=da^e[0];O=Va^e[1];T=ya^e[2];B=aa^e[3];fb=4;for(Wa=1;Wa<d;Wa++)C=h[H>>>24]^l[O>>16&255]^m[T>>8&255]^g[B&255]^e[fb],F=h[O>>>24]^l[T>>16&255]^m[B>>8&255]^g[H&255]^e[fb+1],G=h[T>>>24]^l[B>>
16&255]^m[H>>8&255]^g[O&255]^e[fb+2],B=h[B>>>24]^l[H>>16&255]^m[O>>8&255]^g[T&255]^e[fb+3],H=C,O=F,T=G,fb+=4;C=f[H>>>24]<<24^f[O>>16&255]<<16^f[T>>8&255]<<8^f[B&255]^e[fb];F=f[O>>>24]<<24^f[T>>16&255]<<16^f[B>>8&255]<<8^f[H&255]^e[fb+1];G=f[T>>>24]<<24^f[B>>16&255]<<16^f[H>>8&255]<<8^f[O&255]^e[fb+2];B=f[B>>>24]<<24^f[H>>16&255]<<16^f[O>>8&255]<<8^f[T&255]^e[fb+3];fb+=3;z[c]=La(C^p);z[c+1]=La(B^q);z[c+2]=La(G^t);z[c+3]=La(F^n);p=da;q=aa;t=ya;n=Va;c+=4}return new Promise(function(vb){var Jb=z.buffer;
var Cg=Jb.byteLength,lo=Cg&&(new DataView(Jb)).getUint8(Cg-1);Jb=lo?Jb.slice(0,Cg-lo):Jb;vb(Jb)})};JU.prototype.destroy=function(){this.B=this.j=this.f=this.l=this.C=this.o=this.A=this.h=this.a=this.w=null;return new Promise(function(a){return a()})};JU.prototype.G=function(a){return a<<24|(a&65280)<<8|(a&16711680)>>8|a>>>24};LU.prototype.importKey=function(a){var b=this,c;return _.I(function(d){if(1==d.a)return c=b,_.y(d,crypto.subtle.importKey("raw",a,{name:"AES-CBC"},!1,["decrypt"]),2);c.a=d.f;_.A(d)})};LU.prototype.decrypt=function(a,b){var c=this,d;return _.I(function(e){if(1==e.a)return _.y(e,crypto.subtle.decrypt({name:"AES-CBC",iv:b},c.a,a),2);d=e.f;return e["return"](d)})};LU.prototype.destroy=function(){this.a=null;return new Promise(function(a){return a()})};_.x(MU,_.tt);MU.prototype.f=function(){if(window.crypto&&crypto.subtle){var a=crypto.subtle.decrypt;a=typeof crypto.subtle.importKey===_.re&&typeof a===_.re}else a=!1;(this.l=a)||this.g.warn("No WebCrypto APIs found. Will fallback to software AES")};MU.prototype.o=function(a){var b=OU(this,a);a.getNetworkEngine().Oc(b)};MU.prototype.a=function(){this.j={}};MU.prototype.id=function(){return"crypto"};_.J("clpp.crypto.CryptoComponent",MU);};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();